<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>آجر - تطبيق الذكر والأدعية</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color-default: #2f363f;
            --secondary-color-default: #4a5568;
            --accent-color-default: #cbd5e0;
            --text-color-default: #e2e8f0;
            --counter-color-default: #a0aec0;
            --reset-color-default: #ef4444;
            --add-color-default: #3b82f6;
            --vibration-color-default: #f97316;
            --card-bg-default: rgba(255,255,255,.08);
            --border-color-default: rgba(255,255,255,.1);
            --modal-bg-default: rgba(0,0,0,.5);
            --dua-icon-color: #10b981;
            --completed-color: #10b981;
            --category-bg-default: rgba(255,255,255,.05);
            --light-primary-color: #f1f5f9;
            --light-secondary-color: #e2e8f0;
            --light-text-color: #1e293b;
            --light-accent-color: #334155;
            --light-card-bg: rgba(255,255,255,.8);
            --light-border-color: rgba(0,0,0,.1);
            --light-modal-bg: rgba(255,255,255,.7);
            --light-category-bg: #fff;
            --theme-primary: var(--primary-color-default);
            --theme-secondary: var(--secondary-color-default);
            --theme-counter: var(--counter-color-default);
            --theme-reset: var(--reset-color-default);
            --theme-add: var(--add-color-default);
            --theme-accent: var(--accent-color-default);
            --theme-text: var(--text-color-default);
            --theme-card-bg: var(--card-bg-default);
            --theme-border-color: var(--border-color-default);
            --theme-vibration: var(--vibration-color-default);
            --modal-bg: var(--modal-bg-default);
            --category-bg: var(--category-bg-default);
            --icon-size: 24px;
            
            /* New Theme Colors */
            --theme-purple-primary: #4c1d95;
            --theme-purple-secondary: #7c3aed;
            --theme-purple-accent: #c4b5fd;
            
            --theme-blue-primary: #1e3a8a;
            --theme-blue-secondary: #3b82f6;
            --theme-blue-accent: #93c5fd;
            
            --theme-green-primary: #065f46;
            --theme-green-secondary: #10b981;
            --theme-green-accent: #a7f3d0;
            
            --theme-rose-primary: #881337;
            --theme-rose-secondary: #f43f5e;
            --theme-rose-accent: #fda4af;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Tajawal', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            padding-bottom: 80px; /* Space for tab bar */
            transition: background-color .5s ease, color .5s ease;
            overflow-x: hidden;
            text-align: right;
            position: relative;
            background: linear-gradient(135deg, var(--theme-primary), var(--theme-secondary));
            color: var(--theme-text);
            -webkit-tap-highlight-color: transparent;
        }

        body.light-mode {
            --theme-primary: var(--light-primary-color);
            --theme-secondary: var(--light-secondary-color);
            --theme-text: var(--light-text-color);
            --theme-accent: var(--light-accent-color);
            --theme-card-bg: var(--light-card-bg);
            --theme-border-color: var(--light-border-color);
            --modal-bg: var(--light-modal-bg);
            --category-bg: var(--light-category-bg);
        }

        body.theme-purple {
            --theme-primary: var(--theme-purple-primary);
            --theme-secondary: var(--theme-purple-secondary);
            --theme-accent: var(--theme-purple-accent);
        }

        body.theme-blue {
            --theme-primary: var(--theme-blue-primary);
            --theme-secondary: var(--theme-blue-secondary);
            --theme-accent: var(--theme-blue-accent);
        }

        body.theme-green {
            --theme-primary: var(--theme-green-primary);
            --theme-secondary: var(--theme-green-secondary);
            --theme-accent: var(--theme-green-accent);
        }

        body.theme-rose {
            --theme-primary: var(--theme-rose-primary);
            --theme-secondary: var(--theme-rose-secondary);
            --theme-accent: var(--theme-rose-accent);
        }

        .container {
            width: 100%;
            max-width: 420px;
            background-color: var(--theme-card-bg);
            backdrop-filter: blur(25px) saturate(1.5);
            -webkit-backdrop-filter: blur(25px) saturate(1.5);
            border-radius: 25px;
            padding: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,.4);
            border: 2px solid var(--theme-border-color);
            transition: all .5s ease;
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: auto;
            margin-bottom: auto;
            position: relative;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        h1 {
            font-weight: 900;
            font-size: 1.8rem;
            color: var(--theme-accent);
        }

        /* Modern Tab Bar */
        .tab-bar {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 400px;
            display: flex;
            justify-content: space-around;
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 12px;
            border: 1px solid var(--theme-border-color);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 1000;
        }

        .tab-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: none;
            border: none;
            color: var(--theme-text);
            opacity: 0.7;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 8px 12px;
            border-radius: 15px;
            flex: 1;
            max-width: 20%;
        }

        .tab-button:hover {
            opacity: 0.9;
            background-color: rgba(255,255,255,0.05);
        }

        .tab-button.active {
            opacity: 1;
            background-color: rgba(255,255,255,0.15);
            transform: translateY(-2px);
        }

        .tab-button .tab-icon {
            width: 22px;
            height: 22px;
            margin-bottom: 5px;
            stroke: var(--theme-accent);
        }

        .tab-button.active .tab-icon {
            stroke: var(--theme-counter);
        }

        .tab-button .tab-label {
            font-size: 0.7rem;
            font-weight: 600;
        }

        .tab-content {
            display: none;
            flex-direction: column;
            gap: 15px;
        }

        .tab-content.active {
            display: flex;
        }

        /* Counter Section */
        .counter-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 15px 0;
            min-height: 280px;
            flex-grow: 1;
        }

        .counter-display {
            font-size: 5.5rem;
            font-weight: 900;
            color: var(--theme-counter);
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(255,255,255,.4), 0 5px 15px rgba(0,0,0,.2);
            transition: all .1s ease-out;
        }

        .dhikr-name {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--theme-accent);
            opacity: .95;
            min-height: 1.3em;
            padding: 0 10px;
        }

        .target-display {
            font-size: .9rem;
            font-weight: 600;
            color: var(--theme-accent);
            opacity: .8;
            margin-bottom: 15px;
            min-height: .9em;
        }

        .counter-button {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            background-color: var(--theme-counter);
            border: 4px solid rgba(255,255,255,.3);
            color: var(--theme-primary);
            font-size: 1.4rem;
            font-weight: 900;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform .15s ease, box-shadow .2s ease;
            box-shadow: 0 10px 20px rgba(0,0,0,.4), 0 0 20px var(--theme-counter);
            text-align: center;
            padding: 8px;
            user-select: none;
        }

        .counter-button:active {
            transform: scale(.92);
            box-shadow: 0 3px 8px rgba(0,0,0,.3);
        }

        .bottom-controls {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .base-control {
            padding: 10px 16px;
            border: none;
            border-radius: 25px;
            font-size: .85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all .2s ease;
            box-shadow: 0 3px 10px rgba(0,0,0,.1);
            text-align: center;
            color: var(--theme-text);
            background-color: rgba(255,255,255,.1);
            border: 1px solid var(--theme-border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            position: relative;
            text-decoration: none;
        }

        .base-control:hover {
            background-color: rgba(255,255,255,.15);
            transform: translateY(-1px);
        }

        .reset-button {
            background-color: var(--theme-reset);
            color: #fff;
        }

        .control-row {
            display: flex;
            gap: 8px;
            width: 100%;
        }

        /* Duas Section */
        .duas-category-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 10px;
            overflow-y: auto;
            flex-grow: 1;
            padding-bottom: 20px;
            max-height: 400px;
        }

        .dua-category-item {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding: 15px 20px;
            background-color: var(--category-bg);
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: transform .2s ease, background-color .2s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,.1);
            gap: 15px;
            text-align: right;
            border: 1px solid var(--theme-border-color);
        }

        .dua-category-item:hover {
            transform: translateY(-3px);
            background-color: rgba(255,255,255,.1);
        }

        .dua-category-item .icon {
            stroke: var(--dua-icon-color);
        }

        /* Quran Section */
        .quran-surah-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 10px;
            overflow-y: auto;
            flex-grow: 1;
            padding-bottom: 20px;
            max-height: 400px;
        }

        .quran-surah-item {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding: 15px 20px;
            background-color: var(--category-bg);
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: transform .2s ease, background-color .2s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,.1);
            gap: 15px;
            text-align: right;
            border: 1px solid var(--theme-border-color);
        }

        .quran-surah-item:hover {
            transform: translateY(-3px);
            background-color: rgba(255,255,255,.1);
        }

        .quran-reader-view {
            display: none;
            flex-direction: column;
            gap: 10px;
            padding: 10px;
            overflow-y: auto;
            flex-grow: 1;
            padding-bottom: 20px;
        }

        .quran-reader-header {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--theme-counter);
            margin-bottom: 20px;
            text-align: center;
        }

        .quran-ayat-list {
            list-style: none;
            padding: 0;
            margin: 0;
            text-align: right;
            font-size: 1.3rem;
            line-height: 2.2;
            color: var(--theme-text);
            font-weight: 500;
            direction: rtl;
        }

        .quran-ayat-list li {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed rgba(255,255,255,.05);
        }

        .quran-ayat-list li:last-child {
            border-bottom: none;
        }

        .quran-ayat-number {
            font-size: .9em;
            color: var(--theme-accent);
            opacity: .8;
            margin-left: 8px;
            font-weight: 600;
        }

        .quran-nav-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .dua-nav-button {
            background-color: var(--theme-add);
            color: #fff;
            padding: 12px 30px;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            font-weight: 700;
            font-size: 1rem;
            transition: background-color .2s ease, transform .1s ease;
        }

        .dua-nav-button:disabled {
            background-color: var(--theme-secondary);
            cursor: not-allowed;
            opacity: .6;
        }

        .dua-nav-button:active {
            transform: scale(.95);
        }

        /* Floating Back Button */
        .floating-back-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--theme-add);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 1001;
            transition: transform 0.2s ease;
        }

        .floating-back-button:hover {
            transform: scale(1.05);
        }

        .floating-back-button:active {
            transform: scale(0.95);
        }

        /* Statistics Section */
        .statistics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 15px 0;
        }

        .stat-card {
            background-color: rgba(255,255,255,.05);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid var(--theme-border-color);
        }

        .stat-value {
            font-size: 1.4rem;
            font-weight: 900;
            color: var(--theme-counter);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: .8rem;
            color: var(--theme-accent);
            opacity: .8;
        }

        .daily-goal-section {
            background-color: rgba(255,255,255,.05);
            padding: 15px;
            border-radius: 12px;
            margin: 15px 0;
            border: 1px solid var(--theme-border-color);
        }

        .goal-progress {
            width: 100%;
            height: 8px;
            background-color: rgba(0,0,0,.2);
            border-radius: 4px;
            margin: 10px 0;
            overflow: hidden;
        }

        .goal-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--theme-add), var(--theme-counter));
            border-radius: 4px;
            transition: width .3s ease;
        }

        .achievement-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            background-color: var(--completed-color);
            color: #fff;
            border-radius: 15px;
            font-size: .7rem;
            font-weight: 600;
            margin: 5px;
        }

        /* Settings Section */
        .settings-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background-color: var(--category-bg);
            border-radius: 15px;
            border: 1px solid var(--theme-border-color);
        }

        .setting-label {
            font-weight: 600;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--theme-add);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        .theme-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 10px;
        }

        .theme-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s ease;
        }

        .theme-option.active {
            border-color: var(--theme-accent);
            transform: scale(1.1);
        }

        .theme-default { background: linear-gradient(135deg, #2f363f, #4a5568); }
        .theme-purple { background: linear-gradient(135deg, #4c1d95, #7c3aed); }
        .theme-blue { background: linear-gradient(135deg, #1e3a8a, #3b82f6); }
        .theme-green { background: linear-gradient(135deg, #065f46, #10b981); }
        .theme-rose { background: linear-gradient(135deg, #881337, #f43f5e); }

        .charity-footer {
            margin-top: 20px;
            padding: 10px;
            font-size: .75rem;
            text-align: center;
            color: var(--theme-accent);
            opacity: .6;
            font-weight: 500;
            position: relative;
            z-index: 5;
            width: 100%;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--modal-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            z-index: 100;
            justify-content: center;
            align-items: center;
            animation: fadeInModal .2s ease-out;
        }

        .modal-content {
            background-color: var(--theme-secondary);
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 420px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,.4);
            border: 1px solid var(--theme-border-color);
            animation: slideInModal .3s ease-out;
            max-height: 90vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        @keyframes fadeInModal {
            from { opacity: 0 }
            to { opacity: 1 }
        }

        @keyframes slideInModal {
            from { transform: translateY(50px); opacity: 0 }
            to { transform: translateY(0); opacity: 1 }
        }

        .modal-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--theme-accent);
            font-weight: 700;
        }

        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .modal-button {
            padding: 8px 20px;
            border: none;
            border-radius: 25px;
            font-weight: 700;
            cursor: pointer;
            transition: all .2s ease;
            font-size: .9rem;
        }

        .modal-confirm {
            background-color: #10b981;
            color: #fff;
        }

        .modal-cancel {
            background-color: var(--theme-reset);
            color: #fff;
        }

        .add-modal-input {
            width: 100%;
            padding: 10px 15px;
            margin-top: 15px;
            border-radius: 10px;
            border: 1px solid var(--theme-border-color);
            background-color: rgba(0,0,0,.1);
            color: var(--theme-text);
            font-size: 1rem;
            text-align: right;
            box-sizing: border-box;
        }

        .toast {
            position: fixed;
            bottom: 80px;
            right: 50%;
            transform: translateX(50%);
            background-color: #10b981;
            color: #fff;
            padding: 10px 20px;
            border-radius: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,.2);
            opacity: 0;
            visibility: hidden;
            transition: opacity .3s ease, transform .3s ease;
            z-index: 200;
            font-weight: 600;
            text-align: center;
            direction: rtl;
        }

        .toast.show {
            opacity: 1;
            visibility: visible;
            transform: translateX(50%) translateY(-10px);
        }

        @media (max-width:600px){
            .container {
                padding: 15px;
                max-width: 95%;
                gap: 12px;
            }
            h1 {
                font-size: 1.6rem;
            }
            .counter-display {
                font-size: 4.8rem;
            }
            .counter-button {
                width: 150px;
                height: 150px;
                font-size: 1.2rem;
            }
            .dhikr-name {
                font-size: 1.2rem;
            }
            .tab-bar {
                padding: 10px;
                width: 95%;
            }
            .tab-button {
                padding: 6px 8px;
            }
            .tab-button .tab-icon {
                width: 18px;
                height: 18px;
            }
            .tab-button .tab-label {
                font-size: 0.65rem;
            }
            .floating-back-button {
                width: 45px;
                height: 45px;
                top: 15px;
                right: 15px;
            }
        }
    </style>
</head>
<body class="dark-mode">
    <div class="container">
        <div class="header">
            <h1>آجر</h1>
        </div>
        
        <!-- Tab Content -->
        <div class="tab-content active" id="counter-tab">
            <div class="counter-area">
                <div class="counter-display" id="counter">0</div>
                <div class="dhikr-name" id="dhikr-name">استغفر الله</div>
                <div class="target-display" id="target-display">الهدف: لا يوجد</div>
                <button class="counter-button" id="counter-button">آجر</button>
            </div>
            <div class="bottom-controls">
                <div class="control-row">
                    <button class="base-control" id="select-dhikr-button" style="flex: 1;">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="stroke: white;">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
                        </svg>
                        <span>اختر ذكرًا</span>
                    </button>
                    <button class="base-control" id="set-target-button" style="flex: 1;">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="stroke: var(--theme-accent);">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M12 16v-4m0-4v-.5"></path>
                            <path d="M12 7a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"></path>
                        </svg>
                        <span>تعيين الهدف</span>
                    </button>
                </div>
                <div class="control-row">
                    <button class="base-control" id="add-dhikr-button" style="flex: 1; background-color: var(--theme-add); color: white;">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="stroke: white;">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        <span>أضف ذكر</span>
                    </button>
                    <button class="base-control reset-button" id="reset-button" style="flex: 1;">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="stroke: white;">
                            <path d="M20 12v-1c0-4.42-3.58-8-8-8S4 6.58 4 11s3.58 8 8 8c.7 0 1.39-.08 2.05-.24"/>
                            <path d="M19 16l3 3-3 3"/>
                            <path d="M22 19h-5"/>
                        </svg>
                        <span>تصفير العداد</span>
                    </button>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="duas-tab">
            <div class="duas-category-list" id="duas-category-list">
                <!-- سيتم تعبئة الأدعية ديناميكياً -->
            </div>
        </div>
        
        <div class="tab-content" id="quran-tab">
            <div class="quran-surah-list" id="quran-surah-list">
                <!-- سيتم تعبئة قائمة السور ديناميكياً -->
            </div>
            <div class="quran-reader-view" id="quran-reader-view">
                <div class="quran-reader-header" id="quran-surah-title"></div>
                <ul id="quran-ayat-list" class="quran-ayat-list"></ul>
                <div class="quran-nav-buttons">
                    <button class="dua-nav-button" id="prev-surah-button" disabled>السورة السابقة</button>
                    <button class="dua-nav-button" id="next-surah-button">السورة التالية</button>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="statistics-tab">
            <div class="statistics-grid">
                <div class="stat-card">
                    <div class="stat-value" id="today-count">0</div>
                    <div class="stat-label">تسبيحات اليوم</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-count">0</div>
                    <div class="stat-label">إجمالي التسبيحات</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="streak-days">0</div>
                    <div class="stat-label">أيام متتالية</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avg-daily">0</div>
                    <div class="stat-label">المتوسط اليومي</div>
                </div>
            </div>
            
            <div class="daily-goal-section">
                <h4 style="color: var(--theme-accent); margin-bottom: 10px;">الهدف اليومي</h4>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <span id="daily-goal-text">لا يوجد هدف</span>
                    <button class="modal-button modal-confirm" id="set-daily-goal-button" style="padding: 5px 15px; font-size: 0.8rem;">تعيين هدف</button>
                </div>
                <div class="goal-progress">
                    <div class="goal-progress-bar" id="daily-progress-bar" style="width: 0%"></div>
                </div>
                <div style="text-align: center; font-size: 0.8rem; color: var(--theme-accent); opacity: 0.8;">
                    <span id="daily-progress-text">0 / 0</span>
                </div>
            </div>
            
            <div id="achievements-section">
                <h4 style="color: var(--theme-accent); margin: 15px 0 10px;">🏆 الإنجازات</h4>
                <div id="achievements-list"></div>
            </div>
        </div>
        
        <div class="tab-content" id="settings-tab">
            <div class="settings-section">
                <div class="setting-item">
                    <span class="setting-label">الوضع الليلي</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="dark-mode-toggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                
                <div class="setting-item">
                    <span class="setting-label">تفعيل الاهتزاز</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="vibration-toggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                
                <div class="setting-item">
                    <span class="setting-label">الأرقام العربية</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="arabic-numerals-toggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                
                <div class="setting-item" style="flex-direction: column; align-items: flex-start;">
                    <span class="setting-label" style="margin-bottom: 10px;">اختيار الثيم</span>
                    <div class="theme-selector">
                        <div class="theme-option theme-default active" data-theme="default"></div>
                        <div class="theme-option theme-purple" data-theme="purple"></div>
                        <div class="theme-option theme-blue" data-theme="blue"></div>
                        <div class="theme-option theme-green" data-theme="green"></div>
                        <div class="theme-option theme-rose" data-theme="rose"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="charity-footer">
            هذا التطبيق صدقة جارية لـ **عبدالله أبوشكير ووالديه واخوانه واخواته**
        </div>
    </div>

    <!-- Modern Tab Bar -->
    <div class="tab-bar">
        <button class="tab-button active" data-tab="counter">
            <svg class="tab-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            <span class="tab-label">الرئيسية</span>
        </button>
        <button class="tab-button" data-tab="duas">
            <svg class="tab-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 2a1 1 0 0 1 1 1v1a1 1 0 0 1-2 0V3a1 1 0 0 1 1-1zM20 12a1 1 0 0 1 1-1h1a1 1 0 0 1 0 2h-1a1 1 0 0 1-1-1zM4 12a1 1 0 0 1 1-1h1a1 1 0 0 1 0 2H5a1 1 0 0 1-1-1zM12 20a1 1 0 0 1 1 1v1a1 1 0 0 1-2 0v-1a1 1 0 0 1 1-1zM18.36 5.64a1 1 0 0 1 .71-.29h.01a1 1 0 0 1 .7 1.7L18.36 6.7a1 1 0 0 1-1.41-1.41l1.41-1.41zM5.64 18.36a1 1 0 0 1-.71.29H4.9a1 1 0 0 1-.7-1.7l1.41-1.41a1 1 0 0 1 1.41 1.41l-1.41 1.41zM18.36 18.36a1 1 0 0 1 0-1.41l1.41-1.41a1 1 0 0 1 1.41 1.41l-1.41 1.41a1 1 0 0 1-1.41 0zM5.64 5.64a1 1 0 0 1 0-1.41L7.05 2.82a1 1 0 0 1 1.41 1.41L7.05 5.64a1 1 0 0 1-1.41 0z"/>
            </svg>
            <span class="tab-label">الأدعية</span>
        </button>
        <button class="tab-button" data-tab="quran">
            <svg class="tab-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
            </svg>
            <span class="tab-label">القرآن</span>
        </button>
        <button class="tab-button" data-tab="statistics">
            <svg class="tab-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 3v18h18"/>
                <path d="m19 9-5 5-4-4-3 3"/>
            </svg>
            <span class="tab-label">الإحصائيات</span>
        </button>
        <button class="tab-button" data-tab="settings">
            <svg class="tab-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
            </svg>
            <span class="tab-label">الإعدادات</span>
        </button>
    </div>

    <!-- Floating Back Button -->
    <button class="floating-back-button" id="floating-back-button" style="display: none;">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
    </button>

    <!-- Modals -->
    <div class="modal" id="select-dhikr-modal">
        <div class="modal-content">
            <h3 class="modal-title">اختر ذكرًا</h3>
            <input type="text" id="select-dhikr-modal-search-input" class="add-modal-input" placeholder="ابحث عن ذكر..." dir="rtl">
            <ul id="select-dhikr-list" class="dhikr-list-container"></ul>
            <div class="modal-buttons">
                <button class="modal-button modal-cancel" id="close-select-dhikr-modal">إغلاق</button>
            </div>
        </div>
    </div>

    <div class="modal" id="set-target-modal">
        <div class="modal-content">
            <h3 class="modal-title">تعيين هدف الذكر</h3>
            <input type="number" id="target-input" class="add-modal-input" placeholder="أدخل العدد المستهدف..." min="1" dir="rtl">
            <div class="modal-buttons">
                <button class="modal-button modal-confirm" id="save-target">حفظ الهدف</button>
                <button class="modal-button modal-cancel" id="cancel-target">إلغاء</button>
            </div>
        </div>
    </div>

    <div class="modal" id="add-dhikr-modal">
        <div class="modal-content">
            <h3 class="modal-title">إضافة ذكر جديد</h3>
            <input type="text" id="new-dhikr-input" class="add-modal-input" placeholder="اكتب الذكر هنا..." dir="rtl">
            <div class="modal-buttons">
                <button class="modal-button modal-confirm" id="save-new-dhikr">حفظ وإضافة</button>
                <button class="modal-button modal-cancel" id="cancel-new-dhikr">إلغاء</button>
            </div>
        </div>
    </div>

    <div class="modal" id="reset-modal">
        <div class="modal-content">
            <h3 class="modal-title">هل أنت متأكد من التصفير؟</h3>
            <p>سيتم تصفير العداد الحالي.</p>
            <div class="modal-buttons">
                <button class="modal-button modal-confirm" id="confirm-reset">نعم، تصفير</button>
                <button class="modal-button modal-cancel" id="cancel-reset">إلغاء</button>
            </div>
        </div>
    </div>

    <div class="modal" id="set-daily-goal-modal">
        <div class="modal-content">
            <h3 class="modal-title">تعيين الهدف اليومي</h3>
            <input type="number" id="daily-goal-input" class="add-modal-input" placeholder="أدخل الهدف اليومي..." min="1" dir="rtl">
            <div class="modal-buttons">
                <button class="modal-button modal-confirm" id="save-daily-goal">حفظ الهدف</button>
                <button class="modal-button modal-cancel" id="cancel-daily-goal">إلغاء</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast" role="alert" aria-live="polite"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Tab Bar Functionality
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            const floatingBackButton = document.getElementById('floating-back-button');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const tabId = button.getAttribute('data-tab');
                    
                    // Update active tab button
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    
                    // Show active tab content
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === `${tabId}-tab`) {
                            content.classList.add('active');
                        }
                    });
                    
                    // Show/hide floating back button
                    if (tabId === 'quran' && isInQuranReader) {
                        floatingBackButton.style.display = 'flex';
                    } else {
                        floatingBackButton.style.display = 'none';
                    }
                });
            });

            // App State
            let count = 0;
            let currentDhikr = 'استغفر الله';
            let targetCount = 0;
            let currentSurahIndex = 0;
            let surahList = [];
            let isInQuranReader = false;
            let isDarkMode = true;
            let isVibrationEnabled = true;
            let useArabicNumerals = true;
            let currentTheme = 'default';
            let dailyGoal = 0;
            
            // Statistics Data
            let statisticsData = {
                dailyHistory: {},
                totalCount: 0,
                currentStreak: 0,
                longestStreak: 0,
                achievements: []
            };

            // DOM Elements
            const counterDisplay = document.getElementById('counter');
            const dhikrNameElement = document.getElementById('dhikr-name');
            const targetDisplay = document.getElementById('target-display');
            const counterButton = document.getElementById('counter-button');
            const selectDhikrButton = document.getElementById('select-dhikr-button');
            const setTargetButton = document.getElementById('set-target-button');
            const addDhikrButton = document.getElementById('add-dhikr-button');
            const resetButton = document.getElementById('reset-button');
            const quranSurahList = document.getElementById('quran-surah-list');
            const quranReaderView = document.getElementById('quran-reader-view');
            const quranSurahTitle = document.getElementById('quran-surah-title');
            const quranAyatList = document.getElementById('quran-ayat-list');
            const prevSurahButton = document.getElementById('prev-surah-button');
            const nextSurahButton = document.getElementById('next-surah-button');
            const toastElement = document.getElementById('toast');
            const duasCategoryList = document.getElementById('duas-category-list');
            
            // Statistics Elements
            const todayCountElement = document.getElementById('today-count');
            const totalCountElement = document.getElementById('total-count');
            const streakDaysElement = document.getElementById('streak-days');
            const avgDailyElement = document.getElementById('avg-daily');
            const dailyProgressBar = document.getElementById('daily-progress-bar');
            const dailyProgressText = document.getElementById('daily-progress-text');
            const dailyGoalText = document.getElementById('daily-goal-text');
            const setDailyGoalButton = document.getElementById('set-daily-goal-button');
            const achievementsList = document.getElementById('achievements-list');
            
            // Settings Elements
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            const vibrationToggle = document.getElementById('vibration-toggle');
            const arabicNumeralsToggle = document.getElementById('arabic-numerals-toggle');
            const themeOptions = document.querySelectorAll('.theme-option');

            // Default Dhikr list
            const defaultDhikrs = [
                "استغفر الله",
                "سبحان الله",
                "سبحان الله وبحمده",
                "سبحان الله العظيم",
                "سبحان الله وبحمده سبحان الله العظيم",
                "الحمد لله",
                "الحمد لله رب العالمين",
                "الله أكبر",
                "الله أكبر كبيرا",
                "لا إله إلا الله",
                "لا إله إلا الله وحده لا شريك له",
                "لا حول ولا قوة إلا بالله",
                "أستغفر الله وأتوب إليه",
                "اللهم صلي على محمد"
            ];
            let userDhikrs = [];

            // Initialize App
            function initApp() {
                loadState();
                setupEventListeners();
                updateDisplay();
                loadQuranSurahs();
                loadDuas();
                updateStatistics();
                
                // Set initial state of settings
                darkModeToggle.checked = isDarkMode;
                vibrationToggle.checked = isVibrationEnabled;
                arabicNumeralsToggle.checked = useArabicNumerals;
                
                // Set active theme
                setActiveTheme(currentTheme);
            }

            // Load Quran Surahs from API
            async function loadQuranSurahs() {
                try {
                    // Using Tanzil API - a reliable Quran API
                    const response = await fetch('https://api.alquran.cloud/v1/surah');
                    const data = await response.json();
                    
                    if (data.code === 200 && data.data) {
                        surahList = data.data;
                        renderQuranSurahList();
                    } else {
                        // Fallback to static data if API fails
                        loadStaticQuranData();
                    }
                } catch (error) {
                    console.error('Error loading Quran data:', error);
                    // Fallback to static data
                    loadStaticQuranData();
                }
            }

            // Static Quran data as fallback
            function loadStaticQuranData() {
                surahList = [
                    { number: 1, name: "الفاتحة", englishName: "Al-Fatiha", numberOfAyahs: 7 },
                    { number: 2, name: "البقرة", englishName: "Al-Baqarah", numberOfAyahs: 286 },
                    { number: 36, name: "يس", englishName: "Yaseen", numberOfAyahs: 83 },
                    { number: 55, name: "الرحمن", englishName: "Ar-Rahman", numberOfAyahs: 78 },
                    { number: 67, name: "الملك", englishName: "Al-Mulk", numberOfAyahs: 30 },
                    { number: 112, name: "الإخلاص", englishName: "Al-Ikhlas", numberOfAyahs: 4 },
                    { number: 113, name: "الفلق", englishName: "Al-Falaq", numberOfAyahs: 5 },
                    { number: 114, name: "الناس", englishName: "An-Nas", numberOfAyahs: 6 }
                ];
                renderQuranSurahList();
            }

            // Render Quran Surah List
            function renderQuranSurahList() {
                quranSurahList.innerHTML = '';
                
                surahList.forEach(surah => {
                    const surahItem = document.createElement('div');
                    surahItem.classList.add('quran-surah-item');
                    surahItem.innerHTML = `
                        <span>${surah.number}. ${surah.name} (${surah.englishName})</span>
                        <div class="category-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                            </svg>
                        </div>
                    `;
                    surahItem.addEventListener('click', () => displayQuranSurah(surah.number - 1));
                    quranSurahList.appendChild(surahItem);
                });
            }

            // Display Quran Surah
            async function displayQuranSurah(surahIndex) {
                currentSurahIndex = surahIndex;
                const surah = surahList[surahIndex];
                
                if (!surah) {
                    showToast("حدث خطأ في تحميل السورة.");
                    return;
                }

                // Hide surah list and show reader
                quranSurahList.style.display = 'none';
                quranReaderView.style.display = 'flex';
                isInQuranReader = true;
                floatingBackButton.style.display = 'flex';

                quranSurahTitle.textContent = `${surah.number}. ${surah.name} (${surah.englishName})`;
                quranAyatList.innerHTML = '<li>جاري التحميل...</li>';

                try {
                    // Fetch surah details from API
                    const response = await fetch(`https://api.alquran.cloud/v1/surah/${surah.number}/ar.alafasy`);
                    const data = await response.json();
                    
                    if (data.code === 200 && data.data) {
                        const ayahs = data.data.ayahs;
                        quranAyatList.innerHTML = '';
                        
                        ayahs.forEach(ayah => {
                            const li = document.createElement('li');
                            li.innerHTML = `${ayah.text} <span class="quran-ayat-number">(${formatNumberDisplay(ayah.numberInSurah)})</span>`;
                            quranAyatList.appendChild(li);
                        });
                    } else {
                        quranAyatList.innerHTML = '<li>عذراً، تعذر تحميل الآيات.</li>';
                    }
                } catch (error) {
                    console.error('Error loading surah details:', error);
                    quranAyatList.innerHTML = '<li>عذراً، تعذر تحميل الآيات.</li>';
                }

                // Update navigation buttons
                prevSurahButton.disabled = currentSurahIndex === 0;
                nextSurahButton.disabled = currentSurahIndex === surahList.length - 1;
            }

            // Load Duas from API
            async function loadDuas() {
                try {
                    // Using a reliable Islamic API for Duas
                    const response = await fetch('https://islamic-api.vercel.app/api/duas');
                    const data = await response.json();
                    
                    if (data && data.length > 0) {
                        renderDuas(data);
                    } else {
                        // Fallback to static data if API fails
                        loadStaticDuas();
                    }
                } catch (error) {
                    console.error('Error loading Duas:', error);
                    // Fallback to static data
                    loadStaticDuas();
                }
            }

            // Static Duas data as fallback
            function loadStaticDuas() {
                const staticDuas = [
                    {
                        category: "أذكار الصباح",
                        duas: [
                            { arabic: "أصبحنا وأصبح الملك لله، والحمد لله، لا إله إلا الله وحده لا شريك له، له الملك وله الحمد وهو على كل شيء قدير.", source: "صحيح مسلم" },
                            { arabic: "اللهم بك أصبحنا، وبك أمسينا، وبك نحيا، وبك نموت، وإليك النشور.", source: "سنن الترمذي" }
                        ]
                    },
                    {
                        category: "أذكار المساء",
                        duas: [
                            { arabic: "أمسينا وأمسى الملك لله، والحمد لله، لا إله إلا الله وحده لا شريك له، له الملك وله الحمد وهو على كل شيء قدير.", source: "صحيح مسلم" },
                            { arabic: "اللهم بك أمسينا، وبك أصبحنا، وبك نحيا، وبك نموت، وإليك المصير.", source: "سنن الترمذي" }
                        ]
                    },
                    {
                        category: "أذكار النوم",
                        duas: [
                            { arabic: "باسمك اللهم أموت وأحيا.", source: "صحيح البخاري" },
                            { arabic: "اللهم رب السماوات ورب الأرض ورب العرش العظيم، ربنا ورب كل شيء، فالق الحب والنوى، ومنزل التوراة والإنجيل والفرقان، أعوذ بك من شر كل شيء أنت آخذ بناصيته.", source: "صحيح مسلم" }
                        ]
                    },
                    {
                        category: "أدعية متنوعة",
                        duas: [
                            { arabic: "اللهم إني أعوذ بك من الهم والحزن، وأعوذ بك من العجز والكسل، وأعوذ بك من الجبن والبخل، وأعوذ بك من غلبة الدين وقهر الرجال.", source: "صحيح البخاري" },
                            { arabic: "اللهم اجعل في قلبي نوراً، وفي بصري نوراً، وفي سمعي نوراً، وعن يميني نوراً، وعن يساري نوراً، وفوقي نوراً، وتحتي نوراً، وأمامي نوراً، وخلفي نوراً، واجعل لي نوراً.", source: "صحيح مسلم" }
                        ]
                    }
                ];
                renderDuas(staticDuas);
            }

            // Render Duas
            function renderDuas(duasData) {
                duasCategoryList.innerHTML = '';
                
                duasData.forEach(category => {
                    const categoryItem = document.createElement('div');
                    categoryItem.classList.add('dua-category-item');
                    categoryItem.innerHTML = `
                        <span>${category.category}</span>
                        <div class="category-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 2a1 1 0 0 1 1 1v1a1 1 0 0 1-2 0V3a1 1 0 0 1 1-1zM20 12a1 1 0 0 1 1-1h1a1 1 0 0 1 0 2h-1a1 1 0 0 1-1-1zM4 12a1 1 0 0 1 1-1h1a1 1 0 0 1 0 2H5a1 1 0 0 1-1-1zM12 20a1 1 0 0 1 1 1v1a1 1 0 0 1-2 0v-1a1 1 0 0 1 1-1zM18.36 5.64a1 1 0 0 1 .71-.29h.01a1 1 0 0 1 .7 1.7L18.36 6.7a1 1 0 0 1-1.41-1.41l1.41-1.41zM5.64 18.36a1 1 0 0 1-.71.29H4.9a1 1 0 0 1-.7-1.7l1.41-1.41a1 1 0 0 1 1.41 1.41l-1.41 1.41zM18.36 18.36a1 1 0 0 1 0-1.41l1.41-1.41a1 1 0 0 1 1.41 1.41l-1.41 1.41a1 1 0 0 1-1.41 0zM5.64 5.64a1 1 0 0 1 0-1.41L7.05 2.82a1 1 0 0 1 1.41 1.41L7.05 5.64a1 1 0 0 1-1.41 0z"/>
                            </svg>
                        </div>
                    `;
                    categoryItem.addEventListener('click', () => showDuaCategory(category));
                    duasCategoryList.appendChild(categoryItem);
                });
            }

            // Show Dua Category
            function showDuaCategory(category) {
                // Create a simple modal to display duas
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.style.display = 'flex';
                
                let duasHTML = '';
                category.duas.forEach(dua => {
                    duasHTML += `
                        <div style="margin-bottom: 20px; text-align: right;">
                            <div style="font-size: 1.2rem; line-height: 1.8; margin-bottom: 5px;">${dua.arabic}</div>
                            <div style="font-size: 0.9rem; color: var(--theme-accent); opacity: 0.7;">${dua.source}</div>
                        </div>
                    `;
                });
                
                modal.innerHTML = `
                    <div class="modal-content">
                        <h3 class="modal-title">${category.category}</h3>
                        <div style="max-height: 60vh; overflow-y: auto;">
                            ${duasHTML}
                        </div>
                        <div class="modal-buttons">
                            <button class="modal-button modal-cancel" id="close-dua-modal">إغلاق</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                document.getElementById('close-dua-modal').addEventListener('click', () => {
                    document.body.removeChild(modal);
                });
                
                // Close modal when clicking outside
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        document.body.removeChild(modal);
                    }
                });
            }

            // Load State from LocalStorage
            function loadState() {
                try {
                    const savedState = localStorage.getItem('thikrAppState');
                    const savedStatistics = localStorage.getItem('thikrStatistics');
                    const savedSettings = localStorage.getItem('thikrSettings');
                    
                    if (savedState) {
                        const state = JSON.parse(savedState);
                        count = state.count || 0;
                        currentDhikr = state.currentDhikr || 'استغفر الله';
                        targetCount = state.targetCount || 0;
                        userDhikrs = state.userDhikrs || [];
                    }
                    
                    if (savedStatistics) {
                        statisticsData = JSON.parse(savedStatistics);
                    }
                    
                    if (savedSettings) {
                        const settings = JSON.parse(savedSettings);
                        isDarkMode = settings.isDarkMode !== undefined ? settings.isDarkMode : true;
                        isVibrationEnabled = settings.isVibrationEnabled !== undefined ? settings.isVibrationEnabled : true;
                        useArabicNumerals = settings.useArabicNumerals !== undefined ? settings.useArabicNumerals : true;
                        currentTheme = settings.currentTheme || 'default';
                        dailyGoal = settings.dailyGoal || 0;
                    }
                } catch (e) {
                    console.error("Failed to load state:", e);
                }
            }

            // Save State to LocalStorage
            function saveState() {
                const state = {
                    count,
                    currentDhikr,
                    targetCount,
                    userDhikrs
                };
                localStorage.setItem('thikrAppState', JSON.stringify(state));
                
                const settings = {
                    isDarkMode,
                    isVibrationEnabled,
                    useArabicNumerals,
                    currentTheme,
                    dailyGoal
                };
                localStorage.setItem('thikrSettings', JSON.stringify(settings));
                
                localStorage.setItem('thikrStatistics', JSON.stringify(statisticsData));
            }

            // Update Display
            function updateDisplay() {
                counterDisplay.textContent = formatNumberDisplay(count);
                dhikrNameElement.textContent = currentDhikr;
                
                if (targetCount > 0) {
                    targetDisplay.textContent = `الهدف: ${formatNumberDisplay(targetCount)}`;
                } else {
                    targetDisplay.textContent = 'الهدف: لا يوجد';
                }
            }

            // Format Number Display
            function formatNumberDisplay(number) {
                if (useArabicNumerals) {
                    const arabicNumerals = ['٠', '١', '٢', '٣', '٤', '٥', '٦', '٧', '٨', '٩'];
                    return String(number).split('').map(digit => {
                        return arabicNumerals[parseInt(digit)] || digit;
                    }).join('');
                } else {
                    return String(number);
                }
            }

            // Setup Event Listeners
            function setupEventListeners() {
                // Counter Button
                counterButton.addEventListener('click', handleCounterClick);
                
                // Select Dhikr Button
                selectDhikrButton.addEventListener('click', openSelectDhikrModal);
                
                // Set Target Button
                setTargetButton.addEventListener('click', openSetTargetModal);
                
                // Add Dhikr Button
                addDhikrButton.addEventListener('click', openAddDhikrModal);
                
                // Reset Button
                resetButton.addEventListener('click', openResetModal);
                
                // Quran Navigation
                prevSurahButton.addEventListener('click', () => {
                    if (currentSurahIndex > 0) {
                        displayQuranSurah(currentSurahIndex - 1);
                    }
                });
                
                nextSurahButton.addEventListener('click', () => {
                    if (currentSurahIndex < surahList.length - 1) {
                        displayQuranSurah(currentSurahIndex + 1);
                    }
                });
                
                // Floating Back Button
                floatingBackButton.addEventListener('click', () => {
                    if (isInQuranReader) {
                        quranReaderView.style.display = 'none';
                        quranSurahList.style.display = 'flex';
                        isInQuranReader = false;
                        floatingBackButton.style.display = 'none';
                    }
                });
                
                // Statistics
                setDailyGoalButton.addEventListener('click', openSetDailyGoalModal);
                
                // Settings
                darkModeToggle.addEventListener('change', toggleDarkMode);
                vibrationToggle.addEventListener('change', toggleVibration);
                arabicNumeralsToggle.addEventListener('change', toggleArabicNumerals);
                themeOptions.forEach(option => {
                    option.addEventListener('click', handleThemeChange);
                });
                
                // Modal Events
                setupModalEvents();
            }

            // Setup Modal Events
            function setupModalEvents() {
                // Select Dhikr Modal
                const selectDhikrModal = document.getElementById('select-dhikr-modal');
                const closeSelectDhikrModalBtn = document.getElementById('close-select-dhikr-modal');
                const selectDhikrList = document.getElementById('select-dhikr-list');
                const selectDhikrSearchInput = document.getElementById('select-dhikr-modal-search-input');
                
                closeSelectDhikrModalBtn.addEventListener('click', () => {
                    selectDhikrModal.style.display = 'none';
                });
                
                selectDhikrSearchInput.addEventListener('input', (e) => {
                    populateDhikrList(e.target.value);
                });
                
                // Set Target Modal
                const setTargetModal = document.getElementById('set-target-modal');
                const saveTargetButton = document.getElementById('save-target');
                const cancelTargetButton = document.getElementById('cancel-target');
                const targetInput = document.getElementById('target-input');
                
                saveTargetButton.addEventListener('click', saveTarget);
                cancelTargetButton.addEventListener('click', () => {
                    setTargetModal.style.display = 'none';
                });
                
                // Add Dhikr Modal
                const addDhikrModal = document.getElementById('add-dhikr-modal');
                const saveNewDhikrBtn = document.getElementById('save-new-dhikr');
                const cancelNewDhikrBtn = document.getElementById('cancel-new-dhikr');
                const newDhikrInput = document.getElementById('new-dhikr-input');
                
                saveNewDhikrBtn.addEventListener('click', saveNewDhikr);
                cancelNewDhikrBtn.addEventListener('click', () => {
                    addDhikrModal.style.display = 'none';
                });
                
                // Reset Modal
                const resetModal = document.getElementById('reset-modal');
                const confirmResetButton = document.getElementById('confirm-reset');
                const cancelResetButton = document.getElementById('cancel-reset');
                
                confirmResetButton.addEventListener('click', confirmReset);
                cancelResetButton.addEventListener('click', () => {
                    resetModal.style.display = 'none';
                });
                
                // Set Daily Goal Modal
                const setDailyGoalModal = document.getElementById('set-daily-goal-modal');
                const saveDailyGoalButton = document.getElementById('save-daily-goal');
                const cancelDailyGoalButton = document.getElementById('cancel-daily-goal');
                const dailyGoalInput = document.getElementById('daily-goal-input');
                
                saveDailyGoalButton.addEventListener('click', saveDailyGoal);
                cancelDailyGoalButton.addEventListener('click', () => {
                    setDailyGoalModal.style.display = 'none';
                });
                
                // Close modals when clicking outside
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('modal')) {
                        e.target.style.display = 'none';
                    }
                });
            }

            // Handle Counter Click
            function handleCounterClick() {
                count++;
                updateDisplay();
                recordDhikr();
                saveState();
                vibrate();
                
                if (targetCount > 0 && count === targetCount) {
                    showToast(`تهانينا! لقد وصلت إلى هدفك: ${formatNumberDisplay(targetCount)} تسبيحة!`, 5000);
                }
            }

            // Record Dhikr in Statistics
            function recordDhikr() {
                const today = new Date().toISOString().split('T')[0];
                
                // Update daily history
                if (!statisticsData.dailyHistory[today]) {
                    statisticsData.dailyHistory[today] = 0;
                }
                statisticsData.dailyHistory[today]++;
                
                // Update total count
                statisticsData.totalCount++;
                
                // Update streak
                updateStreak();
                
                // Update statistics display
                updateStatistics();
            }

            // Update Streak
            function updateStreak() {
                const today = new Date().toISOString().split('T')[0];
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                const yesterdayString = yesterday.toISOString().split('T')[0];
                
                const todayCount = statisticsData.dailyHistory[today] || 0;
                const yesterdayCount = statisticsData.dailyHistory[yesterdayString] || 0;
                
                if (todayCount > 0) {
                    if (yesterdayCount > 0) {
                        // Continue streak only if we haven't counted this day yet
                        if (todayCount === 1) {
                            statisticsData.currentStreak++;
                        }
                    } else {
                        // Start new streak
                        statisticsData.currentStreak = 1;
                    }
                    
                    // Update longest streak
                    if (statisticsData.currentStreak > statisticsData.longestStreak) {
                        statisticsData.longestStreak = statisticsData.currentStreak;
                    }
                }
            }

            // Update Statistics Display
            function updateStatistics() {
                const today = new Date().toISOString().split('T')[0];
                const todayCount = statisticsData.dailyHistory[today] || 0;
                
                // Update display
                todayCountElement.textContent = formatNumberDisplay(todayCount);
                totalCountElement.textContent = formatNumberDisplay(statisticsData.totalCount);
                streakDaysElement.textContent = formatNumberDisplay(statisticsData.currentStreak);
                
                // Calculate average
                const historyLength = Object.keys(statisticsData.dailyHistory).length;
                const average = historyLength > 0 ? Math.round(statisticsData.totalCount / historyLength) : 0;
                avgDailyElement.textContent = formatNumberDisplay(average);
                
                // Update daily goal progress
                updateDailyGoalProgress(todayCount);
                
                // Update achievements
                updateAchievements();
            }

            // Update Daily Goal Progress
            function updateDailyGoalProgress(todayCount) {
                if (dailyGoal > 0) {
                    dailyGoalText.textContent = `${formatNumberDisplay(dailyGoal)} تسبيحة يومياً`;
                    const progress = Math.min((todayCount / dailyGoal) * 100, 100);
                    dailyProgressBar.style.width = `${progress}%`;
                    dailyProgressText.textContent = `${formatNumberDisplay(todayCount)} / ${formatNumberDisplay(dailyGoal)}`;
                } else {
                    dailyGoalText.textContent = 'لا يوجد هدف';
                    dailyProgressBar.style.width = '0%';
                    dailyProgressText.textContent = '0 / 0';
                }
            }

            // Update Achievements
            function updateAchievements() {
                achievementsList.innerHTML = '';
                
                const achievementDefinitions = [
                    { id: 'first_100', name: 'المبتدئ', description: 'أول 100 تسبيحة', requirement: 100, icon: '🌱' },
                    { id: 'first_500', name: 'المثابر', description: '500 تسبيحة', requirement: 500, icon: '🌿' },
                    { id: 'first_1000', name: 'المجتهد', description: '1000 تسبيحة', requirement: 1000, icon: '🌳' },
                    { id: 'daily_100', name: 'يوم مثمر', description: '100 تسبيحة في يوم واحد', requirement: 100, type: 'daily', icon: '☀️' }
                ];
                
                achievementDefinitions.forEach(achievement => {
                    if (isAchievementUnlocked(achievement)) {
                        if (!statisticsData.achievements.includes(achievement.id)) {
                            statisticsData.achievements.push(achievement.id);
                            showToast(`🎉 إنجاز جديد: ${achievement.name}!`, 3000);
                        }
                        
                        const badge = document.createElement('div');
                        badge.className = 'achievement-badge';
                        badge.innerHTML = `${achievement.icon} ${achievement.name}`;
                        badge.title = achievement.description;
                        achievementsList.appendChild(badge);
                    }
                });
                
                if (achievementsList.children.length === 0) {
                    achievementsList.innerHTML = '<div style="color: var(--theme-accent); opacity: 0.6; font-size: 0.9rem;">لا توجد إنجازات بعد</div>';
                }
            }

            // Check if Achievement is Unlocked
            function isAchievementUnlocked(achievement) {
                const today = new Date().toISOString().split('T')[0];
                const todayCount = statisticsData.dailyHistory[today] || 0;
                
                switch (achievement.type) {
                    case 'daily':
                        return todayCount >= achievement.requirement;
                    default:
                        return statisticsData.totalCount >= achievement.requirement;
                }
            }

            // Open Select Dhikr Modal
            function openSelectDhikrModal() {
                const modal = document.getElementById('select-dhikr-modal');
                modal.style.display = 'flex';
                populateDhikrList('');
            }

            // Populate Dhikr List
            function populateDhikrList(filter) {
                const selectDhikrList = document.getElementById('select-dhikr-list');
                selectDhikrList.innerHTML = '';
                
                const allDhikrs = [...defaultDhikrs, ...userDhikrs];
                const filteredDhikrs = allDhikrs.filter(dhikr => 
                    dhikr.toLowerCase().includes(filter.toLowerCase())
                );
                
                filteredDhikrs.forEach(dhikr => {
                    const li = document.createElement('li');
                    li.classList.add('dhikr-list-item');
                    li.textContent = dhikr;
                    li.addEventListener('click', () => {
                        currentDhikr = dhikr;
                        updateDisplay();
                        saveState();
                        document.getElementById('select-dhikr-modal').style.display = 'none';
                        showToast(`تم اختيار: ${dhikr}`);
                    });
                    selectDhikrList.appendChild(li);
                });
            }

            // Open Set Target Modal
            function openSetTargetModal() {
                const modal = document.getElementById('set-target-modal');
                modal.style.display = 'flex';
                document.getElementById('target-input').value = targetCount > 0 ? targetCount : '';
            }

            // Save Target
            function saveTarget() {
                const newTarget = parseInt(document.getElementById('target-input').value);
                if (!isNaN(newTarget) && newTarget > 0) {
                    targetCount = newTarget;
                    updateDisplay();
                    saveState();
                    document.getElementById('set-target-modal').style.display = 'none';
                    showToast(`تم تعيين الهدف إلى ${formatNumberDisplay(targetCount)}`);
                } else {
                    showToast("الرجاء إدخال رقم صحيح موجب");
                }
            }

            // Open Add Dhikr Modal
            function openAddDhikrModal() {
                const modal = document.getElementById('add-dhikr-modal');
                modal.style.display = 'flex';
                document.getElementById('new-dhikr-input').value = '';
            }

            // Save New Dhikr
            function saveNewDhikr() {
                const newDhikr = document.getElementById('new-dhikr-input').value.trim();
                if (newDhikr === '') {
                    showToast("الرجاء كتابة الذكر أولاً.");
                    return;
                }

                const allDhikrs = [...defaultDhikrs, ...userDhikrs];
                if (allDhikrs.includes(newDhikr)) {
                    showToast("هذا الذكر موجود بالفعل.");
                    return;
                }

                userDhikrs.push(newDhikr);
                document.getElementById('add-dhikr-modal').style.display = 'none';
                currentDhikr = newDhikr;
                updateDisplay();
                saveState();
                showToast(`تم إضافة "${newDhikr}" بنجاح.`);
            }

            // Open Reset Modal
            function openResetModal() {
                document.getElementById('reset-modal').style.display = 'flex';
            }

            // Confirm Reset
            function confirmReset() {
                count = 0;
                updateDisplay();
                saveState();
                document.getElementById('reset-modal').style.display = 'none';
                showToast("تم تصفير العداد");
                vibrate();
            }

            // Open Set Daily Goal Modal
            function openSetDailyGoalModal() {
                const modal = document.getElementById('set-daily-goal-modal');
                modal.style.display = 'flex';
                document.getElementById('daily-goal-input').value = dailyGoal > 0 ? dailyGoal : '';
            }

            // Save Daily Goal
            function saveDailyGoal() {
                const newGoal = parseInt(document.getElementById('daily-goal-input').value);
                if (!isNaN(newGoal) && newGoal > 0) {
                    dailyGoal = newGoal;
                    saveState();
                    updateStatistics();
                    document.getElementById('set-daily-goal-modal').style.display = 'none';
                    showToast(`تم تعيين الهدف اليومي إلى ${formatNumberDisplay(newGoal)}.`);
                } else {
                    showToast("الرجاء إدخال رقم صحيح موجب");
                }
            }

            // Toggle Dark Mode
            function toggleDarkMode() {
                isDarkMode = darkModeToggle.checked;
                if (isDarkMode) {
                    document.body.classList.remove('light-mode');
                    document.body.classList.add('dark-mode');
                } else {
                    document.body.classList.remove('dark-mode');
                    document.body.classList.add('light-mode');
                }
                saveState();
            }

            // Toggle Vibration
            function toggleVibration() {
                isVibrationEnabled = vibrationToggle.checked;
                saveState();
                if (isVibrationEnabled) {
                    showToast("تم تفعيل الاهتزاز.");
                    vibrate();
                } else {
                    showToast("تم كتم الاهتزاز.");
                }
            }

            // Toggle Arabic Numerals
            function toggleArabicNumerals() {
                useArabicNumerals = arabicNumeralsToggle.checked;
                updateDisplay();
                updateStatistics();
                saveState();
            }

            // Handle Theme Change
            function handleThemeChange() {
                const theme = this.getAttribute('data-theme');
                setActiveTheme(theme);
                currentTheme = theme;
                saveState();
                showToast(`تم تطبيق الثيم: ${theme}`);
            }

            // Set Active Theme
            function setActiveTheme(theme) {
                // Remove all theme classes
                document.body.classList.remove('theme-purple', 'theme-blue', 'theme-green', 'theme-rose');
                
                // Add the selected theme class
                if (theme !== 'default') {
                    document.body.classList.add(`theme-${theme}`);
                }
                
                // Update active theme option
                themeOptions.forEach(option => {
                    option.classList.remove('active');
                    if (option.getAttribute('data-theme') === theme) {
                        option.classList.add('active');
                    }
                });
            }

            // Vibrate
            function vibrate() {
                if (isVibrationEnabled && navigator.vibrate) {
                    navigator.vibrate(50);
                }
            }

            // Show Toast Message
            function showToast(message, duration = 3000) {
                toastElement.textContent = message;
                toastElement.classList.add('show');
                setTimeout(() => {
                    toastElement.classList.remove('show');
                }, duration);
            }

            // Initialize the app
            initApp();
        });
    </script>
</body>
</html>
