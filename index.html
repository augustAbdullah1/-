<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>آجر - تطبيق الذكر والأدعية</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        /* -------------------------------------- */
        /* CSS Variable Definitions & Themes      */
        /* -------------------------------------- */
        :root {
            /* Default Dark Mode (Slate/Amber) */
            --primary-color-default: #1e293b; 
            --secondary-color-default: #334155; 
            --accent-color-default: #e2e8f0; 
            --text-color-default: #f8fafc; 
            --counter-color-default: #f59e0b; 
            --reset-color-default: #ef4444; 
            --add-color-default: #3b82f6; 
            --vibration-color-default: #f97316; 
            --undo-color-default: #64748b; 
            --card-bg-default: rgba(255, 255, 255, 0.08); 
            --border-color-default: rgba(255, 255, 255, 0.1);
            --modal-bg-default: rgba(0, 0, 0, 0.5);
            --dua-icon-color: #10b981; /* Green color for Dua icon */
            --completed-color: #10b981; /* Green for completed state */
            --category-bg-default: rgba(255, 255, 255, 0.05);
            --quran-icon-color: #f59e0b; /* Amber/Gold color for Quran icon */

            /* Light Mode adjustments */
            --light-primary-color: #f1f5f9; /* Soft White */
            --light-secondary-color: #e2e8f0; /* Lighter Gray */
            --light-text-color: #1e293b; /* Dark Slate */
            --light-accent-color: #334155; /* Darker Slate */
            --light-card-bg: rgba(255, 255, 255, 0.8);
            --light-border-color: rgba(0, 0, 0, 0.1);
            --light-modal-bg: rgba(255, 255, 255, 0.7);
            --light-category-bg: #ffffff;

            /* Dynamic Theme Variables (Updated by JS) */
            --theme-primary: var(--primary-color-default);
            --theme-secondary: var(--secondary-color-default);
            --theme-counter: var(--counter-color-default);
            --theme-reset: var(--reset-color-default);
            --theme-add: var(--add-color-default);
            --theme-accent: var(--accent-color-default);
            --theme-text: var(--text-color-default);
            --theme-card-bg: var(--card-bg-default);
            --theme-border-color: var(--border-color-default);
            --theme-vibration: var(--vibration-color-default);
            --theme-undo: var(--undo-color-default);
            --modal-bg: var(--modal-bg-default);
            --category-bg: var(--category-bg-default);

            /* Icon sizes */
            --icon-size: 24px;
        }

        /* -------------------------------------- */
        /* Base & Mode Styles                     */
        /* -------------------------------------- */
        body {
            font-family: 'Tajawal', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px; 
            transition: background-color 0.5s ease, color 0.5s ease;
            overflow-x: hidden;
            text-align: right; 
            position: relative;
            background: linear-gradient(135deg, var(--theme-primary), var(--theme-secondary));
            color: var(--theme-text);
            -webkit-tap-highlight-color: transparent; 
        }

        /* Light Mode */
        body.light-mode {
            --theme-primary: var(--light-primary-color);
            --theme-secondary: var(--light-secondary-color);
            --theme-text: var(--light-text-color);
            --theme-accent: var(--light-accent-color);
            --theme-card-bg: var(--light-card-bg);
            --theme-border-color: var(--light-border-color);
            --modal-bg: var(--light-modal-bg);
            --category-bg: var(--light-category-bg);
        }

        /* Subtle background animation */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 10% 20%, rgba(255,255,255,0.05) 0%, transparent 50%),
                        radial-gradient(circle at 90% 80%, rgba(255,255,255,0.05) 0%, transparent 50%),
                        radial-gradient(circle at 50% 50%, rgba(255,255,255,0.02) 0%, transparent 80%);
            background-size: 200% 200%;
            animation: moveBackground 25s linear infinite alternate;
            z-index: -2;
        }

        @keyframes moveBackground {
            0% { background-position: 0% 0%; }
            100% { background-position: 100% 100%; }
        }

        /* -------------------------------------- */
        /* Main Container & Layout                */
        /* -------------------------------------- */
        .container {
            width: 100%;
            max-width: 450px; 
            background-color: var(--theme-card-bg);
            backdrop-filter: blur(25px) saturate(1.5); 
            -webkit-backdrop-filter: blur(25px) saturate(1.5);
            border-radius: 30px; 
            padding: 25px; 
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4); 
            border: 2px solid var(--theme-border-color); 
            transition: all 0.5s ease;
            display: flex;
            flex-direction: column;
            gap: 20px; 
            margin-top: auto; 
            margin-bottom: auto;
            position: relative; 
        }

        /* Header & Navigation Bar (Revised) */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px; 
        }

        h1 {
            font-weight: 900;
            font-size: 1.9rem; 
            color: var(--theme-accent);
        }

        /* -------------------------------------- */
        /* Icon Buttons & Controls                */
        /* -------------------------------------- */
        .control-icons {
            display: flex;
            gap: 5px; 
        }

        .icon-button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.1s ease, opacity 0.2s ease, background-color 0.2s ease;
            opacity: 0.9;
            border-radius: 50%;
            width: 38px; 
            height: 38px;
            background-color: rgba(255, 255, 255, 0.1);
        }

        .icon-button:hover {
            opacity: 1;
            transform: scale(1.05);
            background-color: rgba(255, 255, 255, 0.2);
        }

        .icon-button:active {
            transform: scale(0.95);
        }

        .icon {
            width: var(--icon-size); 
            height: var(--icon-size);
            stroke: var(--theme-accent); 
            transition: stroke 0.5s ease;
        }

        /* Override specific icon colors */
        .icon-button.theme-icon .icon {
            stroke: var(--theme-counter); 
        }
        .icon-button.mode-icon .icon {
            stroke: var(--theme-text); 
        }
        .icon-button.dua-icon .icon {
            stroke: var(--dua-icon-color); /* Green color for Dua icon */
        }
        .icon-button.quran-icon .icon {
            stroke: var(--quran-icon-color); /* Quran icon color */
        }
        
        /* Vibration toggle specific styles */
        .vibration-toggle.muted .icon {
            opacity: 0.6;
            stroke: var(--theme-undo);
        }

        /* -------------------------------------- */
        /* Counter Area (Home Screen)             */
        /* -------------------------------------- */
        .counter-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 10px 0; 
            min-height: 250px; 
            flex-grow: 1; 
            /* Added for the home screen view */
            display: flex; 
        }
        
        .counter-display {
            font-size: 5.5rem; 
            font-weight: 900;
            color: var(--theme-counter);
            margin-bottom: 10px; 
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.4), 0 5px 15px rgba(0, 0, 0, 0.2); 
            transition: all 0.1s ease-out; 
        }

        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .counter-display.bounce {
            animation: bounce 0.3s ease-in-out;
        }
        
        .dhikr-name {
            font-size: 1.3rem; 
            font-weight: 700;
            margin-bottom: 10px; 
            color: var(--theme-accent);
            opacity: 0.95;
            min-height: 1.3em; 
            padding: 0 10px;
        }
        
        .counter-button {
            width: 150px; 
            height: 150px; 
            border-radius: 50%;
            background-color: var(--theme-counter);
            border: 4px solid rgba(255, 255, 255, 0.3);
            color: var(--theme-primary); 
            font-size: 1.4rem; 
            font-weight: 900;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.15s ease, box-shadow 0.2s ease;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4), 0 0 20px var(--theme-counter); 
            text-align: center;
            padding: 8px;
            user-select: none; 
        }
        
        .counter-button:active {
            transform: scale(0.92); 
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
        }

        /* -------------------------------------- */
        /* Utility Buttons & Dhikr Selector       */
        /* -------------------------------------- */
        .bottom-controls {
            display: flex;
            flex-direction: column;
            gap: 12px; 
        }

        /* Base button styles for bottom controls */
        .base-control {
            padding: 12px 20px; 
            border: none;
            border-radius: 50px;
            font-size: 0.95rem; 
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease; 
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
            color: var(--theme-text); 
            background-color: rgba(255, 255, 255, 0.1); 
            border: 1px solid var(--theme-border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .base-control:hover {
            background-color: rgba(255, 255, 255, 0.15);
        }

        .undo-button {
            background-color: var(--theme-undo);
            color: white;
        }

        .reset-button {
            background-color: var(--theme-reset);
            color: white;
            /* Added animation for visual improvement */
            animation: pulse-subtle 1.8s infinite ease-in-out; 
        }

        @keyframes pulse-subtle {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.01); opacity: 0.95; }
        }

        .reset-button:hover {
            background-color: #dc2626;
        }
        
        /* Combined row for Undo and Add Dhikr */
        .control-row {
            display: flex;
            gap: 10px;
            width: 100%;
        }

        .dhikr-selector-container {
            position: relative;
            width: 100%;
        }

        .dhikr-search-input {
            width: 100%;
            padding: 12px 20px;
            border: 1px solid var(--theme-border-color);
            border-radius: 50px;
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--theme-text);
            background-color: var(--theme-card-bg);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            text-align: right;
            transition: all 0.2s ease;
            box-sizing: border-box;
            outline: none;
            /* Ensure correct styling for the input field */
            appearance: none;
            -webkit-appearance: none;
        }

        .dhikr-search-input:focus {
            box-shadow: 0 0 0 3px var(--theme-counter);
            border-color: var(--theme-counter);
        }

        .dhikr-dropdown {
            position: absolute;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            background-color: var(--theme-secondary);
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            z-index: 10;
            margin-top: 5px;
            list-style: none;
            padding: 5px 0;
            border: 1px solid var(--theme-border-color);
            display: none; 
        }

        .dhikr-dropdown-item {
            padding: 10px 15px;
            cursor: pointer;
            color: var(--theme-text);
            transition: background-color 0.2s ease;
            text-align: right;
            font-size: 0.9rem;
        }

        .dhikr-dropdown-item:hover,
        .dhikr-dropdown-item.selected {
            background-color: rgba(255, 255, 255, 0.15);
        }

        /* -------------------------------------- */
        /* Themes Panel                           */
        /* -------------------------------------- */
        .themes-panel {
            display: none;
            justify-content: center;
            gap: 12px; 
            flex-wrap: wrap;
            padding: 15px;
            border-radius: 20px;
            background-color: rgba(255, 255, 255, 0.05);
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
            margin-top: 15px;
            border: 1px solid var(--theme-border-color);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .theme-button {
            width: 45px; 
            height: 45px; 
            border-radius: 50%;
            padding: 0;
            border: 4px solid transparent; 
            transition: all 0.2s ease;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            opacity: 0.9;
        }
        
        /* Define theme colors for button previews */
        .theme-default { background: linear-gradient(135deg, #1e293b, #f59e0b); }
        .theme-navy { background: linear-gradient(135deg, #1e3a8a, #fbbf24); }
        .theme-forest { background: linear-gradient(135deg, #166534, #facc15); }
        .theme-sunset { background: linear-gradient(135deg, #9a3412, #f97316); }
        .theme-royal { background: linear-gradient(135deg, #5b21b6, #a78bfa); }
        .theme-coffee { background: linear-gradient(135deg, #451a03, #d97706); }
        
        .theme-button.active {
            border-color: var(--theme-accent); 
            transform: scale(1.08); 
            opacity: 1;
            box-shadow: 0 0 0 4px var(--theme-counter); 
        }
        
        .theme-button:hover {
            transform: scale(1.08);
            opacity: 1;
        }

        /* -------------------------------------- */
        /* Modals & Toasts                        */
        /* -------------------------------------- */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--modal-bg);
            backdrop-filter: blur(12px); 
            -webkit-backdrop-filter: blur(12px);
            z-index: 100;
            justify-content: center;
            align-items: center;
            animation: fadeInModal 0.2s ease-out;
        }
        
        .modal-content {
            background-color: var(--theme-secondary); 
            padding: 25px; 
            border-radius: 15px;
            width: 90%;
            max-width: 450px; 
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            border: 1px solid var(--theme-border-color);
            animation: slideInModal 0.3s ease-out;
            max-height: 90vh;
            /* Fix: Allow scrolling within modal content */
            overflow-y: auto; 
            display: flex;
            flex-direction: column;
        }

        @keyframes fadeInModal {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideInModal {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal-title {
            font-size: 1.4rem; 
            margin-bottom: 15px; 
            color: var(--theme-accent);
            font-weight: 700;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 12px; 
            margin-top: 20px; 
        }
        
        .modal-button {
            padding: 10px 25px; 
            border: none;
            border-radius: 50px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .modal-confirm {
            background-color: #10b981; 
            color: white;
        }
        
        .modal-cancel {
            background-color: var(--theme-reset);
            color: white;
        }

        .add-modal-input {
            width: 100%;
            padding: 10px 15px;
            margin-top: 15px;
            border-radius: 10px;
            border: 1px solid var(--theme-border-color);
            background-color: rgba(0, 0, 0, 0.1);
            color: var(--theme-text);
            font-size: 1rem;
            text-align: right;
        }
        
        .toast {
            position: fixed;
            bottom: 30px;
            right: 50%;
            transform: translateX(50%);
            background-color: #10b981;
            color: white;
            padding: 12px 25px;
            border-radius: 50px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 200;
            font-weight: 600;
            text-align: center;
            direction: rtl; 
        }

        .toast.show {
            opacity: 1;
            visibility: visible;
            transform: translateX(50%) translateY(-10px);
        }

        /* -------------------------------------- */
        /* Dua Modal Styles                       */
        /* -------------------------------------- */
        .duas-category-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 10px;
            overflow-y: auto;
            flex-grow: 1;
            padding-bottom: 20px;
        }

        .dua-category-item {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding: 15px 20px;
            background-color: var(--category-bg);
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: transform 0.2s ease, background-color 0.2s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            gap: 15px;
            text-align: right;
            border: 1px solid var(--theme-border-color);
        }

        .dua-category-item:hover {
            transform: translateY(-3px);
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .dua-category-item .icon {
            stroke: var(--dua-icon-color);
        }

        .dua-category-item.completed {
            opacity: 0.8;
            background-color: rgba(16, 185, 129, 0.1); /* Subtle green background for completed category */
        }

        .completion-status {
            color: var(--completed-color);
            font-size: 0.9rem;
            font-weight: 700;
        }

        /* Dua Reader Styles */
        .dua-reader-content {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex-grow: 1;
            text-align: center;
            padding: 10px;
        }

        .dua-reader-header {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--theme-counter);
            margin-bottom: 20px;
        }

        .dua-reader-text {
            font-size: 1.6rem;
            line-height: 2.2;
            color: var(--theme-text);
            margin-bottom: 25px;
            font-weight: 500;
            direction: rtl;
        }

        .dua-reader-source {
            font-size: 0.9rem;
            color: var(--theme-accent);
            opacity: 0.7;
            margin-bottom: 25px;
        }

        .dua-counter-info {
            font-size: 1rem;
            color: var(--theme-accent);
            margin-bottom: 15px;
        }

        .dua-reader-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .dua-nav-button {
            background-color: var(--theme-add);
            color: white;
            padding: 12px 30px;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            font-weight: 700;
            font-size: 1rem;
            transition: background-color 0.2s ease, transform 0.1s ease;
        }

        .dua-nav-button:disabled {
            background-color: var(--theme-undo);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .dua-nav-button:active {
            transform: scale(0.95);
        }

        .complete-button {
            background-color: var(--completed-color);
            padding: 12px 30px;
            border-radius: 50px;
            border: none;
            color: white;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s ease;
            display: none; /* Hidden by default for non-completed duas */
        }
        
        .completed-mark {
            color: var(--completed-color);
            font-weight: 900;
            font-size: 1.5rem;
            margin-right: 10px;
            display: none;
        }

        /* -------------------------------------- */
        /* Quran Modal Styles                     */
        /* -------------------------------------- */
        .quran-list-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 10px;
            overflow-y: auto;
            flex-grow: 1;
            padding-bottom: 20px;
        }

        .quran-surah-item {
            display: flex;
            align-items: center;
            justify-content: space-between; /* Adjusted for better alignment */
            padding: 15px 20px;
            background-color: var(--category-bg);
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: transform 0.2s ease, background-color 0.2s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-align: right;
            border: 1px solid var(--theme-border-color);
        }

        .quran-surah-item:hover {
            transform: translateY(-3px);
            background-color: rgba(255, 255, 255, 0.1);
        }

        .surah-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .surah-number {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--quran-icon-color);
        }

        /* Quran Reader View */
        .quran-reader-content {
            display: none;
            flex-direction: column;
            flex-grow: 1;
            align-items: center;
            padding: 10px 0;
            overflow-y: auto;
        }

        .quran-page-image {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
        }

        .quran-reader-nav {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 400px;
            padding: 0 10px;
        }

        .quran-nav-button {
            padding: 10px 20px;
            border-radius: 50px;
            border: none;
            background-color: var(--quran-icon-color);
            color: white;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.1s ease;
        }

        .quran-nav-button:disabled {
            background-color: var(--theme-undo);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .quran-nav-button:active {
            transform: scale(0.95);
        }

        .page-number-display {
            color: var(--theme-accent);
            font-weight: 600;
            font-size: 1rem;
            display: flex;
            align-items: center;
        }

        /* -------------------------------------- */
        /* Particle Animation Styles              */
        /* -------------------------------------- */
        .particle {
            position: fixed;
            background-color: var(--particle-color, var(--theme-counter)); 
            border-radius: 50%;
            pointer-events: none;
            z-index: 10;
            transform: translate(-50%, -50%);
            transition: transform 0.8s ease-out, opacity 0.6s ease-out;
            box-shadow: 0 0 5px var(--particle-color, var(--theme-counter));
        }
        
        /* -------------------------------------- */
        /* Perpetual Charity Footer               */
        /* -------------------------------------- */
        .charity-footer {
            margin-top: 30px;
            padding: 15px 10px;
            font-size: 0.8rem;
            text-align: center;
            color: var(--theme-accent);
            opacity: 0.6;
            font-weight: 500;
            position: relative;
            z-index: 5;
            width: 100%;
        }

        /* -------------------------------------- */
        /* Responsive Design                      */
        /* -------------------------------------- */
        @media (max-width: 600px) {
            .container {
                padding: 15px;
                max-width: 95%;
                gap: 15px;
            }
            
            h1 { font-size: 1.7rem; }
            .counter-display { font-size: 5rem; }
            .counter-button { width: 140px; height: 140px; font-size: 1.2rem; }
            .dhikr-name { font-size: 1.2rem; }
            .themes-panel { gap: 8px; }
            .theme-button { width: 40px; height: 40px; }
            .modal-content { padding: 20px; }
            .dua-reader-text { font-size: 1.4rem; }
            .dua-category-item { font-size: 1rem; padding: 12px 15px; }
            .quran-surah-item { font-size: 1rem; padding: 12px 15px; }
        }
    </style>
</head>
<body class="dark-mode">
    <div class="container">
        <div class="header">
            <h1>آجر</h1>
            <div class="control-icons">

                <button class="icon-button quran-button quran-icon" id="quran-button" aria-label="القرآن الكريم">
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="stroke: var(--quran-icon-color);">
                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20v2.5a2.5 2.5 0 0 1-2.5 2.5H6.5A2.5 2.5 0 0 1 4 19.5z" />
                        <path d="M10 20h4" />
                        <path d="M12 17V3" />
                        <path d="M15 15L12 12 9 15" />
                        <path d="M15 11L12 8 9 11" />
                        <path d="M15 7L12 4 9 7" />
                        <path d="M12 3v14" />
                    </svg>
                </button>
                
                <button class="icon-button dua-button dua-icon" id="duas-button" aria-label="الأدعية">
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="stroke: var(--dua-icon-color);">
                        <path d="M12 2a1 1 0 0 1 1 1v1a1 1 0 0 1-2 0V3a1 1 0 0 1 1-1zM20 12a1 1 0 0 1 1-1h1a1 1 0 0 1 0 2h-1a1 1 0 0 1-1-1zM4 12a1 1 0 0 1 1-1h1a1 1 0 0 1 0 2H5a1 1 0 0 1-1-1zM12 20a1 1 0 0 1 1 1v1a1 1 0 0 1-2 0v-1a1 1 0 0 1 1-1zM18.36 5.64a1 1 0 0 1 .71-.29h.01a1 1 0 0 1 .7 1.7L18.36 6.7a1 1 0 0 1-1.41-1.41l1.41-1.41zM5.64 18.36a1 1 0 0 1-.71.29H4.9a1 1 0 0 1-.7-1.7l1.41-1.41a1 1 0 0 1 1.41 1.41l-1.41 1.41zM18.36 18.36a1 1 0 0 1-.71.29H17.65a1 1 0 0 1-.7-1.7l1.41-1.41a1 1 0 0 1 1.41 1.41l-1.41 1.41zM5.64 5.64a1 1 0 0 1 .71-.29h.01a1 1 0 0 1 .7 1.7L5.64 6.7a1 1 0 0 1-1.41-1.41l1.41-1.41z"/>
                        <circle cx="12" cy="12" r="5" />
                        <path d="M12 7.5V12h3" />
                    </svg>
                </button>

                <button class="icon-button theme-toggle theme-icon" id="theme-toggle" aria-label="اختر الثيم">
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 22s8-4 8-10c0-4.42-3.58-8-8-8s-8 3.58-8 8c0 6 8 10 8 10z" />
                        <circle cx="12" cy="12" r="3" />
                    </svg>
                </button>

                <button class="icon-button mode-toggle mode-icon" id="mode-toggle" aria-label="الوضع الفاتح/المظلم">
                    <svg class="icon" id="mode-icon-svg" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path id="mode-icon-path" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                    </svg>
                </button>

                <button class="icon-button vibration-toggle" id="vibration-toggle" aria-label="تفعيل/كتم الاهتزاز">
                    <svg class="icon" id="vibration-icon-svg" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path id="vibration-icon-path" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.899a9 9 0 010 12.728M12 6a6 6 0 00-6 6v3.586l-2-2L3.414 15l4.586 4.586A2 2 0 009 20h6a2 2 0 002-2v-6c0-3.313-2.687-6-6-6z" />
                    </svg>
                </button>
            </div>
        </div>

        <div class="themes-panel" id="themes-panel">
            <button class="theme-button theme-default active" data-theme="default" aria-label="الثيم الافتراضي"></button>
            <button class="theme-button theme-navy" data-theme="navy" aria-label="ثيم البحر"></button>
            <button class="theme-button theme-forest" data-theme="forest" aria-label="ثيم الغابة"></button>
            <button class="theme-button theme-sunset" data-theme="sunset" aria-label="ثيم الغروب"></button>
            <button class="theme-button theme-royal" data-theme="royal" aria-label="ثيم ملكي"></button>
            <button class="theme-button theme-coffee" data-theme="coffee" aria-label="ثيم القهوة"></button>
        </div>
        
        <div class="counter-area" id="main-counter-area">
            <div class="counter-display" id="counter">0</div>
            <div class="dhikr-name" id="dhikr-name">استغفر الله</div>
            <button class="counter-button" id="counter-button">آجر</button>
        </div>
        
        <div class="bottom-controls" id="main-controls">
            
            <div class="dhikr-selector-container">
                <input type="text" id="dhikr-search-input" class="dhikr-search-input" placeholder="ابحث أو اختر ذكرًا..." readonly>
                <ul id="dhikr-dropdown" class="dhikr-dropdown"></ul>
            </div>

            <div class="control-row">
                <button class="base-control undo-button" id="undo-button" style="flex: 1;">
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="stroke: white;">
                        <path d="M19 12a7 7 0 1 0-7 7H5"/>
                        <path d="M12 7v5l2-2"/>
                    </svg>
                    <span>تراجع</span>
                </button>

                <button class="base-control add-dhikr-button" id="add-dhikr-button" style="flex: 1; background-color: var(--theme-add); color: white;">
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="stroke: white;">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    <span>أضف ذكر</span>
                </button>
            </div>

            <button class="base-control reset-button" id="reset-button">
                <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="stroke: white;">
                    <path d="M20 12v-1c0-4.42-3.58-8-8-8S4 6.58 4 11s3.58 8 8 8c.7 0 1.39-.08 2.05-.24"/>
                    <path d="M19 16l3 3-3 3"/>
                    <path d="M22 19h-5"/>
                </svg>
                <span>تصفير العداد</span>
            </button>
        </div>

        <div class="charity-footer">
            هذا التطبيق صدقة جارية لـ **عبدالله أبوشكير ووالديه واخوانه واخواته**
        </div>

    </div>
    
    <div class="modal" id="reset-modal">
        <div class="modal-content">
            <h3 class="modal-title">تغيير الذكر؟</h3>
            <p>عند تغيير نوع الذكر، سيتم تصفير العداد الحالي تلقائيًا.</p>
            <div class="modal-buttons">
                <button class="modal-button modal-confirm" id="confirm-reset">نعم، تغيير</button>
                <button class="modal-button modal-cancel" id="cancel-reset">إلغاء</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="manual-reset-modal">
        <div class="modal-content">
            <h3 class="modal-title">هل أنت متأكد من التصفير؟</h3>
            <p>سيتم تصفير العداد الحالي.</p>
            <div class="modal-buttons">
                <button class="modal-button modal-confirm" id="confirm-manual-reset">نعم، تصفير</button>
                <button class="modal-button modal-cancel" id="cancel-manual-reset">إلغاء</button>
            </div>
        </div>
    </div>

    <div class="modal" id="add-dhikr-modal">
        <div class="modal-content">
            <h3 class="modal-title">إضافة ذكر جديد</h3>
            <input type="text" id="new-dhikr-input" class="add-modal-input" placeholder="اكتب الذكر هنا..." dir="rtl">
            <div class="modal-buttons">
                <button class="modal-button modal-confirm" id="save-new-dhikr">حفظ وإضافة</button>
                <button class="modal-button modal-cancel" id="cancel-new-dhikr">إلغاء</button>
            </div>
        </div>
    </div>

    <div class="modal" id="duas-modal">
        <div class="modal-content">
            <h3 class="modal-title" id="duas-modal-title">الأدعية المأثورة</h3>
            
            <div id="duas-category-list" class="duas-category-list">
                </div>

            <div id="dua-reader-view" class="dua-reader-content">
                <div class="dua-reader-header" id="reader-category-title"></div>
                <div class="dua-reader-text" id="dua-text"></div>
                <div class="dua-reader-source" id="dua-source"></div>
                
                <div id="dua-tally-area">
                    <div id="dua-counter-info" class="dua-counter-info"></div>
                    <div class="counter-display" id="dua-tally-counter">0</div>
                    <button class="counter-button" id="dua-tally-button">عدّ</button>
                </div>

                <div class="dua-reader-controls">
                    <button class="dua-nav-button" id="prev-dua-button" disabled>السابق</button>
                    <button class="dua-nav-button" id="next-dua-button">التالي</button>
                </div>

                <div class="dua-reader-controls">
                    <button class="complete-button" id="complete-category-button">أكملت الفئة</button>
                </div>
            </div>

            <div class="modal-buttons">
                <button class="modal-button modal-cancel" id="duas-back-button" style="display: none;">العودة للفئات</button>
                <button class="modal-button modal-cancel" id="close-duas-modal">إغلاق</button>
            </div>
        </div>
    </div>

    <div class="modal" id="quran-modal">
        <div class="modal-content">
            <h3 class="modal-title" id="quran-modal-title">القرآن الكريم</h3>
            
            <div id="quran-surah-list" class="quran-list-container">
                </div>

            <div id="quran-reader-view" class="quran-reader-content">
                <img id="quran-page-image" class="quran-page-image" alt="صفحة من القرآن الكريم">
                
                <div class="quran-reader-nav">
                    <button class="quran-nav-button" id="quran-prev-page">الصفحة السابقة</button>
                    <span id="page-number-display" class="page-number-display"></span>
                    <button class="quran-nav-button" id="quran-next-page">الصفحة التالية</button>
                </div>
            </div>

            <div class="modal-buttons">
                <button class="modal-button modal-cancel" id="quran-back-button" style="display: none;">العودة للسور</button>
                <button class="modal-button modal-cancel" id="close-quran-modal">إغلاق</button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast" role="alert" aria-live="polite"></div>
    
    <div class="animation" id="animation"></div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --------------------------------------
            //            DOM Elements
            // --------------------------------------
            const counterDisplay = document.getElementById('counter');
            const counterButton = document.getElementById('counter-button');
            const dhikrNameElement = document.getElementById('dhikr-name');
            const dhikrSearchInput = document.getElementById('dhikr-search-input');
            const dhikrDropdown = document.getElementById('dhikr-dropdown');
            const animationContainer = document.getElementById('animation');
            const dhikrResetModal = document.getElementById('reset-modal');
            const manualResetModal = document.getElementById('manual-reset-modal');
            const addDhikrModal = document.getElementById('add-dhikr-modal');
            const newDhikrInput = document.getElementById('new-dhikr-input');
            const saveNewDhikrBtn = document.getElementById('save-new-dhikr');
            const themeToggle = document.getElementById('theme-toggle');
            const themesPanel = document.getElementById('themes-panel');
            const themeButtons = document.querySelectorAll('.theme-button');
            const modeToggle = document.getElementById('mode-toggle');
            const modeIconPath = document.getElementById('mode-icon-path');
            const vibrationToggle = document.getElementById('vibration-toggle'); 
            const vibrationIconPath = document.getElementById('vibration-icon-path'); 
            const toastElement = document.getElementById('toast');
            const body = document.body;
            
            // Main App Sections
            const mainCounterArea = document.getElementById('main-counter-area');
            const mainControls = document.getElementById('main-controls');
            
            // Dua Modal Elements
            const duasButton = document.getElementById('duas-button');
            const duasModal = document.getElementById('duas-modal');
            const closeDuasModalBtn = document.getElementById('close-duas-modal');
            const duasCategoryList = document.getElementById('duas-category-list');
            const duasBackButton = document.getElementById('duas-back-button');
            const duasModalTitle = document.getElementById('duas-modal-title');

            // Dua Reader Elements
            const duaReaderView = document.getElementById('dua-reader-view');
            const readerCategoryTitle = document.getElementById('reader-category-title');
            const duaTextElement = document.getElementById('dua-text');
            const duaSourceElement = document.getElementById('dua-source');
            const prevDuaButton = document.getElementById('prev-dua-button');
            const nextDuaButton = document.getElementById('next-dua-button');
            const completeCategoryButton = document.getElementById('complete-category-button');
            const duaTallyArea = document.getElementById('dua-tally-area');
            const duaTallyCounter = document.getElementById('dua-tally-counter');
            const duaTallyButton = document.getElementById('dua-tally-button');
            const duaCounterInfo = document.getElementById('dua-counter-info');

            // Quran Modal Elements (New)
            const quranButton = document.getElementById('quran-button');
            const quranModal = document.getElementById('quran-modal');
            const closeQuranModalBtn = document.getElementById('close-quran-modal');
            const quranSurahList = document.getElementById('quran-surah-list');
            const quranReaderView = document.getElementById('quran-reader-view');
            const quranPageImage = document.getElementById('quran-page-image');
            const quranPrevPageBtn = document.getElementById('quran-prev-page');
            const quranNextPageBtn = document.getElementById('quran-next-page');
            const quranBackButton = document.getElementById('quran-back-button');
            const quranModalTitle = document.getElementById('quran-modal-title');
            const pageNumberDisplay = document.getElementById('page-number-display');

            // Modal Buttons (Consolidated)
            const confirmResetBtn = document.getElementById('confirm-reset');
            const cancelResetBtn = document.getElementById('cancel-reset');
            const confirmManualResetBtn = document.getElementById('confirm-manual-reset');
            const cancelManualResetBtn = document.getElementById('cancel-manual-reset');
            const cancelNewDhikrBtn = document.getElementById('cancel-new-dhikr');

            // Bottom Controls
            const undoButton = document.getElementById('undo-button'); 
            const addDhikrButton = document.getElementById('add-dhikr-button'); 
            const resetButton = document.getElementById('reset-button'); 

            // --------------------------------------
            //            Application State
            // --------------------------------------
            let count = 0;
            let previousCount = 0; 
            let currentDhikr = '';
            let currentTheme = 'default';
            let isDarkMode = true;
            let isVibrationEnabled = true; 
            let dhikrSelectionPending = null;
            let duaReaderState = {
                currentCategory: null,
                currentIndex: 0,
                completedToday: {}, // Stores completion status for categories today {categoryName: true, date: '2025-07-13'}
                duaCounters: {} // Stores per-dua counters for specific timed duas {categoryId_duaIndex: count}
            };
            
            // Quran Reader State
            let quranReaderState = {
                currentSurah: null,
                currentPage: 0
            };
            
            const targetCounts = [33, 100, 500, 1000]; 
            
            // Default Dhikr list
            const defaultDhikrs = [
                "استغفر الله",
                "سبحان الله",
                "سبحان الله وبحمده",
                "سبحان الله العظيم",
                "سبحان الله وبحمده سبحان الله العظيم",
                "الحمد لله",
                "الحمد لله رب العالمين",
                "الله أكبر",
                "الله أكبر كبيرا",
                "لا إله إلا الله",
                "لا إله إلا الله وحده لا شريك له",
                "لا حول ولا قوة إلا بالله",
                "أستغفر الله وأتوب إليه",
                "اللهم صلي على محمد"
            ];
            let userDhikrs = []; 
            
            // Theme color definitions
            const themes = {
                'default': { primary: '#1e293b', secondary: '#334155', accent: '#e2e8f0', text: '#f8fafc', counter: '#f59e0b', reset: '#ef4444', add: '#3b82f6', vibration: '#f97316', undo: '#64748b' },
                'navy': { primary: '#1e3a8a', secondary: '#1e40af', accent: '#bfdbfe', text: '#dbeafe', counter: '#fbbf24', reset: '#ef4444', add: '#3b82f6', vibration: '#f97316', undo: '#64748b' },
                'forest': { primary: '#166534', secondary: '#15803d', accent: '#dcfce7', text: '#ecfdf5', counter: '#facc15', reset: '#dc2626', add: '#3b82f6', vibration: '#f97316', undo: '#64748b' },
                'sunset': { primary: '#9a3412', secondary: '#c2410c', accent: '#fed7aa', text: '#ffedd5', counter: '#f97316', reset: '#b91c1c', add: '#3b82f6', vibration: '#f97316', undo: '#64748b' },
                'royal': { primary: '#5b21b6', secondary: '#6d28d9', accent: '#e9d5ff', text: '#f3e8ff', counter: '#a78bfa', reset: '#7c3aed', add: '#3b82f6', vibration: '#f97316', undo: '#64748b' },
                'coffee': { primary: '#451a03', secondary: '#713f12', accent: '#fef3c7', text: '#fffbeb', counter: '#d97706', reset: '#92400e', add: '#3b82f6', vibration: '#f97316', undo: '#64748b' }
            };

            // --------------------------------------
            //            Dua Data & Categories (Retained)
            // --------------------------------------
            const duaCategories = [
                {
                    name: "أذكار الصباح",
                    icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v2M4.93 4.93l1.41 1.41M2 12h2M4.93 19.07l1.41-1.41M12 20v2M19.07 19.07l-1.41-1.41M22 12h-2M19.07 4.93l-1.41 1.41"></path><circle cx="12" cy="12" r="5"></circle></svg>`,
                    duas: [
                        { arabic: "الحمد لله الذي أحيانا بعد ما أماتنا وإليه النشور.", source: "صحيح البخاري" },
                        { arabic: "أصبحنا وأصبح الملك لله، والحمد لله، لا إله إلا الله وحده لا شريك له، له الملك وله الحمد وهو على كل شيء قدير. رب أسألك خير ما في هذا اليوم وخير ما بعده، وأعوذ بك من شر ما في هذا اليوم وشر ما بعده. رب أعوذ بك من الكسل وسوء الكبر، رب أعوذ بك من عذاب في النار وعذاب في القبر.", source: "صحيح مسلم" },
                        { arabic: "اللهم بك أصبحنا، وبك أمسينا، وبك نحيا، وبك نموت، وإليك النشور.", source: "سنن الترمذي" },
                        { arabic: "اللهم أنت ربي لا إله إلا أنت، خلقتني وأنا عبدك، وأنا على عهدك ووعدك ما استطعت، أعوذ بك من شر ما صنعت، أبوء لك بنعمتك علي، وأبوء بذنبي فاغفر لي فإنه لا يغفر الذنوب إلا أنت.", source: "صحيح البخاري", count: 1 },
                        { arabic: "اللهم فاطر السماوات والأرض، عالم الغيب والشهادة، رب كل شيء ومليكه، أشهد أن لا إله إلا أنت، أعوذ بك من شر نفسي، ومن شر الشيطان وشركه، وأن أقترف على نفسي سوءاً أو أجره إلى مسلم.", source: "سنن الترمذي" },
                        { arabic: "أصبحنا على فطرة الإسلام، وعلى كلمة الإخلاص، وعلى دين نبينا محمد صلى الله عليه وسلم، وعلى ملة أبينا إبراهيم حنيفاً مسلماً وما كان من المشركين.", source: "صحيح مسلم" },
                        { arabic: "رضيت بالله رباً، وبالإسلام ديناً، وبمحمد صلى الله عليه وسلم نبياً.", source: "سنن أبي داود", count: 3 },
                        { arabic: "يا حي يا قيوم برحمتك أستغيث، أصلح لي شأني كله ولا تكلني إلى نفسي طرفة عين.", source: "صحيح الحاكم" },
                        { arabic: "لا إله إلا الله وحده لا شريك له، له الملك وله الحمد وهو على كل شيء قدير.", source: "صحيح البخاري", count: 100 },
                        { arabic: "سبحان الله وبحمده.", source: "صحيح مسلم", count: 100 }
                    ]
                },
                {
                    name: "أذكار المساء",
                    icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>`,
                    duas: [
                        { arabic: "أمسينا وأمسى الملك لله، والحمد لله، لا إله إلا الله وحده لا شريك له، له الملك وله الحمد وهو على كل شيء قدير. رب أسألك خير ما في هذه الليلة وخير ما بعدها، وأعوذ بك من شر ما في هذه الليلة وشر ما بعدها. رب أعوذ بك من الكسل وسوء الكبر، رب أعوذ بك من عذاب في النار وعذاب في القبر.", source: "صحيح مسلم" },
                        { arabic: "اللهم بك أمسينا، وبك أصبحنا، وبك نحيا، وبك نموت، وإليك المصير.", source: "سنن الترمذي" },
                        { arabic: "اللهم أنت ربي لا إله إلا أنت، خلقتني وأنا عبدك، وأنا على عهدك ووعدك ما استطعت، أعوذ بك من شر ما صنعت، أبوء لك بنعمتك علي، وأبوء بذنبي فاغفر لي فإنه لا يغفر الذنوب إلا أنت.", source: "صحيح البخاري", count: 1 },
                        { arabic: "اللهم فاطر السماوات والأرض، عالم الغيب والشهادة، رب كل شيء ومليكه، أشهد أن لا إله إلا أنت، أعوذ بك من شر نفسي، ومن شر الشيطان وشركه، وأن أقترف على نفسي سوءاً أو أجره إلى مسلم.", source: "سنن الترمذي" },
                        { arabic: "رضيت بالله رباً، وبالإسلام ديناً، وبمحمد صلى الله عليه وسلم نبياً.", source: "سنن أبي داود", count: 3 },
                        { arabic: "يا حي يا قيوم برحمتك أستغيث، أصلح لي شأني كله ولا تكلني إلى نفسي طرفة عين.", source: "صحيح الحاكم" },
                        { arabic: "لا إله إلا الله وحده لا شريك له، له الملك وله الحمد وهو على كل شيء قدير.", source: "صحيح البخاري", count: 100 },
                        { arabic: "سبحان الله وبحمده.", source: "صحيح مسلم", count: 100 }
                    ]
                },
                {
                    name: "أذكار قبل النوم",
                    icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a1 1 0 0 1 1 1v1a1 1 0 0 1-2 0V3a1 1 0 0 1 1-1zM20 12a1 1 0 0 1 1-1h1a1 1 0 0 1 0 2h-1a1 1 0 0 1-1-1zM4 12a1 1 0 0 1 1-1h1a1 1 0 0 1 0 2H5a1 1 0 0 1-1-1zM12 20a1 1 0 0 1 1 1v1a1 1 0 0 1-2 0v-1a1 1 0 0 1 1-1zM18.36 5.64a1 1 0 0 1 .71-.29h.01a1 1 0 0 1 .7 1.7L18.36 6.7a1 1 0 0 1-1.41-1.41l1.41-1.41zM5.64 18.36a1 1 0 0 1-.71.29H4.9a1 1 0 0 1-.7-1.7l1.41-1.41a1 1 0 0 1 1.41 1.41l-1.41 1.41zM18.36 18.36a1 1 0 0 1-.71.29H17.65a1 1 0 0 1-.7-1.7l1.41-1.41a1 1 0 0 1 1.41 1.41l-1.41 1.41zM5.64 5.64a1 1 0 0 1 .71-.29h.01a1 1 0 0 1 .7 1.7L5.64 6.7a1 1 0 0 1-1.41-1.41l1.41-1.41z"/><circle cx="12" cy="12" r="5" /><path d="M12 7.5V12h3" /></svg>`,
                    duas: [
                        { arabic: "باسمك اللهم أموت وأحيا.", source: "صحيح البخاري" },
                        { arabic: "اللهم رب السماوات ورب الأرض ورب العرش العظيم، ربنا ورب كل شيء، فالق الحب والنوى، ومنزل التوراة والإنجيل والفرقان، أعوذ بك من شر كل شيء أنت آخذ بناصيته، اللهم أنت الأول فليس قبلك شيء، وأنت الآخر فليس بعدك شيء، وأنت الظاهر فليس فوقك شيء، وأنت الباطن فليس دونك شيء، اقض عنا الدين وأغننا من الفقر.", source: "صحيح مسلم" },
                        { arabic: "اللهم قني عذابك يوم تبعث عبادك.", source: "سنن الترمذي" },
                        { arabic: "سُبْحَانَ اللَّهِ (33 مرة) وَالْحَمْدُ لِلَّهِ (33 مرة) وَاللَّهُ أَكْبَرُ (34 مرة).", source: "صحيح البخاري", count: 34 }
                    ]
                },
                {
                    name: "أدعية الاستيقاظ",
                    icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a1 1 0 0 1 1 1v1a1 1 0 0 1-2 0V3a1 1 0 0 1 1-1zM20 12a1 1 0 0 1 1-1h1a1 1 0 0 1 0 2h-1a1 1 0 0 1-1-1zM4 12a1 1 0 0 1 1-1h1a1 1 0 0 1 0 2H5a1 1 0 0 1-1-1zM12 20a1 1 0 0 1 1 1v1a1 1 0 0 1-2 0v-1a1 1 0 0 1 1-1zM18.36 5.64a1 1 0 0 1 .71-.29h.01a1 1 0 0 1 .7 1.7L18.36 6.7a1 1 0 0 1-1.41-1.41l1.41-1.41zM5.64 18.36a1 1 0 0 1-.71.29H4.9a1 1 0 0 1-.7-1.7l1.41-1.41a1 1 0 0 1 1.41 1.41l-1.41 1.41zM18.36 18.36a1 1 0 0 1-.71.29H17.65a1 1 0 0 1-.7-1.7l1.41-1.41a1 1 0 0 1 1.41 1.41l-1.41 1.41zM5.64 5.64a1 1 0 0 1 .71-.29h.01a1 1 0 0 1 .7 1.7L5.64 6.7a1 1 0 0 1-1.41-1.41l1.41-1.41z"/><circle cx="12" cy="12" r="5" /><path d="M12 7.5V12h3" /></svg>`,
                    duas: [
                        { arabic: "الحمد لله الذي أحيانا بعد ما أماتنا وإليه النشور.", source: "صحيح البخاري" },
                        { arabic: "لا إله إلا الله وحده لا شريك له، له الملك وله الحمد وهو على كل شيء قدير، سبحان الله، والحمد لله، ولا إله إلا الله، والله أكبر، ولا حول ولا قوة إلا بالله.", source: "صحيح ابن ماجه" }
                    ]
                },
                {
                    name: "أدعية السفر",
                    icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="14.5 17.5 14.5 19.5 12 21 9.5 19.5 9.5 17.5"></polyline><path d="M14.5 17.5l-1.92-1.45a3.1 3.1 0 0 1-.58-.87L9.5 9.5"></path><path d="M16 11l-2.67-2.31a3 3 0 0 0-3.66 0L8 11"></path><path d="M12 15l1-4 2 2 4 4"></path><path d="M3 3l1-1"></path><path d="M12 5l-.5-1"></path><path d="M18.5 4.5l-1-1"></path><path d="M11 9l-1-1"></path></svg>`,
                    duas: [
                        { arabic: "الله أكبر، الله أكبر، سبحان الذي سخر لنا هذا وما كنا له مقرنين، وإنا إلى ربنا لمنقلبون. اللهم إنا نسألك في سفرنا هذا البر والتقوى، ومن العمل ما ترضى، اللهم هون علينا سفرنا هذا واطو عنا بعده، اللهم أنت الصاحب في السفر، والخليفة في الأهل، اللهم إني أعوذ بك من وعثاء السفر، وكآبة المنظر، وسوء المنقلب في المال والأهل.", source: "صحيح مسلم" },
                        { arabic: "آيبون، تائبون، عابدون، لربنا حامدون.", source: "صحيح البخاري" }
                    ]
                },
                {
                    name: "أدعية الصيام (قبل وبعد)",
                    icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="2" ry="2"></rect><line x1="12" y1="12" x2="12" y2="16"></line><line x1="10" y1="14" x2="14" y2="14"></line></svg>`,
                    duas: [
                        { arabic: "ذهب الظمأ وابتلت العروق وثبت الأجر إن شاء الله.", source: "سنن أبي داود" },
                        { arabic: "اللهم إني لك صمت، وعلى رزقك أفطرت.", source: "سنن أبي داود" }
                    ]
                },
                {
                    name: "أدعية متفرقة",
                    icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10c0-4.42-3.58-8-8-8s-8 3.58-8 8c0 6 8 10 8 10z"/><circle cx="12" cy="12" r="3" /></svg>`,
                    duas: [
                        { arabic: "اللهم إني أعوذ بك من الهم والحزن، وأعوذ بك من العجز والكسل، وأعوذ بك من الجبن والبخل، وأعوذ بك من غلبة الدين وقهر الرجال.", source: "صحيح البخاري" },
                        { arabic: "اللهم اجعل في قلبي نوراً، وفي بصري نوراً، وفي سمعي نوراً، وعن يميني نوراً، وعن يساري نوراً، وفوقي نوراً، وتحتي نوراً، وأمامي نوراً، وخلفي نوراً، واجعل لي نوراً.", source: "صحيح مسلم" },
                        { arabic: "اللهم اكفني بحلالك عن حرامك، وأغنني بفضلك عمن سواك.", source: "سنن الترمذي" },
                        { arabic: "اللهم عافني في بدني، اللهم عافني في سمعي، اللهم عافني في بصري، لا إله إلا أنت.", source: "سنن أبي داود" },
                        { arabic: "لا إله إلا الله العظيم الحليم، لا إله إلا الله رب العرش العظيم، لا إله إلا الله رب السموات ورب الأرض ورب العرش الكريم.", source: "صحيح البخاري" },
                        { arabic: "اللهم إني أعوذ بك من عذاب جهنم، ومن عذاب القبر، ومن فتنة المحيا والممات، ومن شر فتنة المسيح الدجال.", source: "صحيح مسلم" },
                        { arabic: "يا مقلب القلوب ثبت قلبي على دينك.", source: "سنن الترمذي" },
                        { arabic: "اللهم إني أسألك الجنة وما قرب إليها من قول أو عمل، وأعوذ بك من النار وما قرب إليها من قول أو عمل.", source: "سنن ابن ماجه" },
                        { arabic: "اللهم إني أسألك الهدى والتقى والعفاف والغنى.", source: "صحيح مسلم" },
                        { arabic: "اللهم إني أعوذ بك من شر ما عملت ومن شر ما لم أعمل.", source: "صحيح مسلم" },
                        { arabic: "اللهم إني أعوذ بك من زوال نعمتك، وتحول عافيتك، وفجاءة نقمتك، وجميع سخطك.", source: "صحيح مسلم" },
                        // Additional Duas merged here for diversity
                        { title: "دعاء الكرب", arabic: "لا إله إلا أنت سبحانك إني كنت من الظالمين.", source: "سنن الترمذي" },
                        { title: "دعاء الهم والحزن", arabic: "اللهم إني عبدك وابن عبدك، ابن أمتك، ناصيتي بيدك، ماض في حكمك، عدل في قضاؤك، أسألك بكل اسم هو لك سميت به نفسك، أو أنزلته في كتابك، أو علمته أحدا من خلقك، أو استأثرت به في علم الغيب عندك، أن تجعل القرآن العظيم ربيع قلبي، ونور صدري، وجلاء حزني، وذهاب همي.", source: "صحيح ابن حبان" },
                        { title: "دعاء الاستغفار", arabic: "أستغفر الله الذي لا إله إلا هو الحي القيوم وأتوب إليه.", source: "سنن أبي داود" },
                        { title: "دعاء سيد الاستغفار", arabic: "اللهم أنت ربي لا إله إلا أنت، خلقتني وأنا عبدك، وأنا على عهدك ووعدك ما استطعت، أعوذ بك من شر ما صنعت، أبوء لك بنعمتك علي، وأبوء بذنبي فاغفر لي فإنه لا يغفر الذنوب إلا أنت.", source: "صحيح البخاري" },
                        { title: "دعاء المصيبة", arabic: "إنا لله وإنا إليه راجعون، اللهم أجرني في مصيبتي واخلف لي خيراً منها.", source: "صحيح مسلم" },
                        { title: "دعاء زيارة المريض", arabic: "اللهم رب الناس، أذهب البأس، اشف أنت الشافي، لا شفاء إلا شفاؤك، شفاءً لا يغادر سقماً.", source: "صحيح البخاري" },
                        { title: "دعاء عند رؤية المبتلى", arabic: "الحمد لله الذي عافاني مما ابتلاك به، وفضلني على كثير ممن خلق تفضيلاً.", source: "سنن الترمذي" },
                        { title: "دعاء قضاء الدين", arabic: "اللهم اكفني بحلالك عن حرامك، وأغنني بفضلك عمن سواك.", source: "سنن الترمذي" },
                        { title: "دعاء دخول السوق", arabic: "لا إله إلا الله وحده لا شريك له، له الملك وله الحمد، يحيي ويميت وهو حي لا يموت، بيده الخير، وهو على كل شيء قدير.", source: "سنن الترمذي" },
                        { title: "دعاء المطر", arabic: "اللهم صيباً نافعاً.", source: "صحيح البخاري" },
                        { title: "دعاء الريح", arabic: "اللهم إني أسألك خيرها، وأعوذ بك من شرها.", source: "سنن الترمذي" },
                        { title: "دعاء الرعد", arabic: "سبحان الذي يسبح الرعد بحمده والملائكة من خيفته.", source: "الموطأ" },
                        { title: "دعاء بعد الأذان", arabic: "اللهم رب هذه الدعوة التامة والصلاة القائمة، آت محمداً الوسيلة والفضيلة، وابعثه مقاماً محموداً الذي وعدته.", source: "صحيح البخاري" },
                        { title: "دعاء دخول المسجد", arabic: "اللهم افتح لي أبواب رحمتك.", source: "صحيح مسلم" },
                        { title: "دعاء الخروج من المسجد", arabic: "اللهم إني أسألك من فضلك.", source: "سنن أبي داود" },
                        { title: "دعاء دخول المنزل", arabic: "باسم الله ولجنا، وباسم الله خرجنا، وعلى الله ربنا توكلنا.", source: "صحيح مسلم" },
                        { title: "دعاء الخروج من المنزل", arabic: "باسم الله، توكلت على الله، ولا حول ولا قوة إلا بالله.", source: "سنن الترمذي" },
                        { title: "دعاء دخول الخلاء", arabic: "اللهم إني أعوذ بك من الخبث والخبائث.", source: "صحيح البخاري" },
                        { title: "دعاء الخروج من الخلاء", arabic: "غفرانك.", source: "سنن أبي داود" },
                        { title: "دعاء الطعام", arabic: "باسم الله.", source: "صحيح البخاري" },
                        { title: "دعاء بعد الطعام", arabic: "الحمد لله الذي أطعمني هذا ورزقنيه من غير حول مني ولا قوة.", source: "سنن أبي داود" },
                        { title: "دعاء التعزية", arabic: "إن لله ما أخذ وله ما أعطى، وكل شيء عنده بأجل مسمى، فلتصبر ولتحتسب.", source: "صحيح البخاري" },
                        { title: "دعاء للمتوفى", arabic: "اللهم اغفر له وارحمه، وعافه واعف عنه، وأكرم نزله، ووسع مدخله، واغسله بالماء والثلج والبرد، ونقه من الخطايا كما نقيت الثوب الأبيض من الدنس.", source: "صحيح مسلم" },
                        { title: "دعاء عند الغضب", arabic: "أعوذ بالله من الشيطان الرجيم.", source: "صحيح البخاري" },
                        { title: "دعاء عند العطاس", arabic: "الحمد لله.", source: "صحيح البخاري" },
                        { title: "دعاء رؤية الهلال", arabic: "اللهم أهله علينا باليمن والإيمان والسلامة والإسلام، ربي وربك الله.", source: "سنن الترمذي" },
                        { title: "دعاء ليلة القدر", arabic: "اللهم إنك عفو تحب العفو فاعف عني.", source: "سنن الترمذي" },
                        { title: "دعاء الاستخارة", arabic: "اللهم إني أستخيرك بعلمك، وأستقدرك بقدرتك، وأسألك من فضلك العظيم، فإنك تقدر ولا أقدر، وتعلم ولا أعلم، وأنت علام الغيوب. اللهم إن كنت تعلم أن هذا الأمر (ويسمي حاجته) خير لي في ديني ومعاشي وعاقبة أمري، فاقدره لي ويسره لي، ثم بارك لي فيه، وإن كنت تعلم أن هذا الأمر شر لي في ديني ومعاشي وعاقبة أمري، فاصرفه عني واصرفني عنه، واقدر لي الخير حيث كان، ثم رضني به.", source: "صحيح البخاري" },
                        { title: "دعاء تيسير الأمور", arabic: "اللهم لا سهل إلا ما جعلته سهلا، وأنت تجعل الحزن إذا شئت سهلاً.", source: "صحيح ابن حبان" },
                        { title: "دعاء للوالدين", arabic: "رب ارحمهما كما ربياني صغيرا.", source: "القرآن الكريم" },
                        { title: "دعاء للمتزوج", arabic: "اللهم بارك لهما وبارك عليهما واجمع بينهما في خير.", source: "سنن الترمذي" },
                        { title: "دعاء لمن صنع لك معروفا", arabic: "جزاك الله خيرا.", source: "سنن الترمذي" },
                        { title: "دعاء لمن أقرضك", arabic: "بارك الله لك في أهلك ومالك.", source: "صحيح ابن ماجه" },
                        { title: "دعاء رؤية المطر", arabic: "اللهم صيباً هنيئاً.", source: "صحيح البخاري" },
                        { title: "دعاء عند الكسوف", arabic: "اللهم إنا نستغفرك ونتوب إليك.", source: "صحيح البخاري" },
                        { title: "دعاء عند الخوف من الظلم", arabic: "اللهم إني أعوذ بك من شرهم.", source: "سنن أبي داود" },
                        { title: "دعاء الخوف من الشرك", arabic: "اللهم إني أعوذ بك أن أشرك بك وأنا أعلم، وأستغفرك لما لا أعلم.", source: "صحيح ابن ماجه" },
                        { title: "دعاء عند الاستياء من القضاء", arabic: "لا حول ولا قوة إلا بالله.", source: "صحيح مسلم" },
                        { title: "دعاء عند سماع نباح الكلب", arabic: "أعوذ بالله من الشيطان الرجيم.", source: "سنن الترمذي" },
                        { title: "دعاء عند الدخول إلى المقابر", arabic: "السلام عليكم أهل الديار من المؤمنين والمسلمين، وإنا إن شاء الله بكم لاحقون، أسأل الله لنا ولكم العافية.", source: "صحيح مسلم" },
                        { title: "دعاء السكينة", arabic: "اللهم إني أسألك السكينة والعافية في الدنيا والآخرة.", source: "سنن الترمذي" },
                        { title: "دعاء العطاس", arabic: "الحمد لله.", source: "صحيح البخاري" },
                        { title: "دعاء ركوب الدابة", arabic: "سبحان الذي سخر لنا هذا وما كنا له مقرنين وإنا إلى ربنا لمنقلبون.", source: "صحيح مسلم" },
                        { title: "دعاء بعد الصلاة", arabic: "اللهم أعني على ذكرك وشكرك وحسن عبادتك.", source: "سنن أبي داود" },
                        { title: "دعاء يوم عرفة", arabic: "لا إله إلا الله وحده لا شريك له، له الملك وله الحمد وهو على كل شيء قدير.", source: "صحيح الترمذي" },
                        { title: "دعاء لطلب المغفرة", arabic: "رب اغفر لي وتب علي إنك أنت التواب الرحيم.", source: "صحيح ابن حبان" },
                        { title: "دعاء لطلب الرزق", arabic: "اللهم اغفر لي وارحمني وعافني وارزقني.", source: "صحيح مسلم" },
                        { title: "دعاء لوجع الرأس", arabic: "ضع يدك على الذي يألم من جسدك وقل بسم الله ثلاثًا، وقل سبع مرات أعوذ بالله وقدرته من شر ما أجد وأحاذر.", source: "صحيح مسلم" },
                        { title: "دعاء قبل الجماع", arabic: "باسم الله، اللهم جنبنا الشيطان، وجنب الشيطان ما رزقتنا.", source: "صحيح البخاري" }
                    ]
                }
            ];

            // --------------------------------------
            //            Quran Data (New)
            // --------------------------------------
            const quranData = [
                { id: 1, name: "الفاتحة", pages: [1, 1] },
                { id: 2, name: "البقرة", pages: [2, 49] },
                { id: 3, name: "آل عمران", pages: [50, 76] },
                { id: 4, name: "النساء", pages: [77, 106] },
                { id: 5, name: "المائدة", pages: [107, 127] },
                { id: 6, name: "الأنعام", pages: [128, 150] },
                { id: 7, name: "الأعراف", pages: [151, 176] },
                { id: 8, name: "الأنفال", pages: [177, 186] },
                { id: 9, name: "التوبة", pages: [187, 207] },
                { id: 10, name: "يونس", pages: [208, 221] },
                { id: 11, name: "هود", pages: [221, 235] },
                { id: 12, name: "يوسف", pages: [235, 248] },
                { id: 13, name: "الرعد", pages: [249, 255] },
                { id: 14, name: "إبراهيم", pages: [255, 261] },
                { id: 15, name: "الحجر", pages: [262, 267] },
                { id: 16, name: "النحل", pages: [267, 281] },
                { id: 17, name: "الإسراء", pages: [282, 293] },
                { id: 18, name: "الكهف", pages: [293, 304] },
                { id: 19, name: "مريم", pages: [305, 311] },
                { id: 20, name: "طه", pages: [312, 321] },
                { id: 21, name: "الأنبياء", pages: [322, 331] },
                { id: 22, name: "الحج", pages: [332, 341] },
                { id: 23, name: "المؤمنون", pages: [342, 350] },
                { id: 24, name: "النور", pages: [350, 359] },
                { id: 25, name: "الفرقان", pages: [359, 366] },
                { id: 26, name: "الشعراء", pages: [367, 376] },
                { id: 27, name: "النمل", pages: [377, 384] },
                { id: 28, name: "القصص", pages: [385, 396] },
                { id: 29, name: "العنكبوت", pages: [396, 404] },
                { id: 30, name: "الروم", pages: [404, 410] },
                { id: 31, name: "لقمان", pages: [411, 414] },
                { id: 32, name: "السجدة", pages: [415, 417] },
                { id: 33, name: "الأحزاب", pages: [418, 427] },
                { id: 34, name: "سبأ", pages: [428, 434] },
                { id: 35, name: "فاطر", pages: [434, 440] },
                { id: 36, name: "يس", pages: [440, 445] },
                { id: 37, name: "الصافات", pages: [446, 452] },
                { id: 38, name: "ص", pages: [453, 458] },
                { id: 39, name: "الزمر", pages: [458, 467] },
                { id: 40, name: "غافر", pages: [467, 476] },
                { id: 41, name: "فصلت", pages: [477, 482] },
                { id: 42, name: "الشورى", pages: [483, 489] },
                { id: 43, name: "الزخرف", pages: [489, 495] },
                { id: 44, name: "الدخان", pages: [496, 498] },
                { id: 45, name: "الجاثية", pages: [499, 502] },
                { id: 46, name: "الأحقاف", pages: [502, 506] },
                { id: 47, name: "محمد", pages: [507, 510] },
                { id: 48, name: "الفتح", pages: [511, 515] },
                { id: 49, name: "الحجرات", pages: [515, 517] },
                { id: 50, name: "ق", pages: [518, 520] },
                { id: 51, name: "الذاريات", pages: [520, 523] },
                { id: 52, name: "الطور", pages: [523, 525] },
                { id: 53, name: "النجم", pages: [526, 528] },
                { id: 54, name: "القمر", pages: [528, 531] },
                { id: 55, name: "الرحمن", pages: [531, 534] },
                { id: 56, name: "الواقعة", pages: [534, 537] },
                { id: 57, name: "الحديد", pages: [537, 541] },
                { id: 58, name: "المجادلة", pages: [542, 545] },
                { id: 59, name: "الحشر", pages: [545, 548] },
                { id: 60, name: "الممتحنة", pages: [549, 551] },
                { id: 61, name: "الصف", pages: [551, 552] },
                { id: 62, name: "الجمعة", pages: [553, 554] },
                { id: 63, name: "المنافقون", pages: [554, 555] },
                { id: 64, name: "التغابن", pages: [556, 557] },
                { id: 65, name: "الطلاق", pages: [557, 559] },
                { id: 66, name: "التحريم", pages: [560, 561] },
                { id: 67, name: "الملك", pages: [562, 564] },
                { id: 68, name: "القلم", pages: [564, 566] },
                { id: 69, name: "الحاقة", pages: [566, 568] },
                { id: 70, name: "المعارج", pages: [568, 570] },
                { id: 71, name: "نوح", pages: [570, 572] },
                { id: 72, name: "الجن", pages: [572, 573] },
                { id: 73, name: "المزمل", pages: [574, 575] },
                { id: 74, name: "المدثر", pages: [575, 577] },
                { id: 75, name: "القيامة", pages: [577, 578] },
                { id: 76, name: "الإنسان", pages: [578, 580] },
                { id: 77, name: "المرسلات", pages: [580, 582] },
                { id: 78, name: "النبأ", pages: [583, 584] },
                { id: 79, name: "النازعات", pages: [584, 585] },
                { id: 80, name: "عبس", pages: [585, 586] },
                { id: 81, name: "التكوير", pages: [586, 587] },
                { id: 82, name: "الإنفطار", pages: [587, 588] },
                { id: 83, name: "المطففين", pages: [588, 589] },
                { id: 84, name: "الإنشقاق", pages: [589, 590] },
                { id: 85, name: "البروج", pages: [590, 591] },
                { id: 86, name: "الطارق", pages: [591, 592] },
                { id: 87, name: "الأعلى", pages: [592, 593] },
                { id: 88, name: "الغاشية", pages: [593, 594] },
                { id: 89, name: "الفجر", pages: [594, 595] },
                { id: 90, name: "البلد", pages: [596, 596] },
                { id: 91, name: "الشمس", pages: [596, 597] },
                { id: 92, name: "الليل", pages: [597, 598] },
                { id: 93, name: "الضحى", pages: [598, 599] },
                { id: 94, name: "الشرح", pages: [599, 600] },
                { id: 95, name: "التين", pages: [600, 601] },
                { id: 96, name: "العلق", pages: [601, 602] },
                { id: 97, name: "القدر", pages: [602, 603] },
                { id: 98, name: "البينة", pages: [603, 604] },
                { id: 99, name: "الزلزلة", pages: [604, 605] },
                { id: 100, name: "العاديات", pages: [605, 606] },
                { id: 101, name: "القارعة", pages: [606, 607] },
                { id: 102, name: "التكاثر", pages: [607, 608] },
                { id: 103, name: "العصر", pages: [608, 609] },
                { id: 104, name: "الهمزة", pages: [609, 610] },
                { id: 105, name: "الفيل", pages: [610, 611] },
                { id: 106, name: "قريش", pages: [611, 612] },
                { id: 107, name: "الماعون", pages: [612, 613] },
                { id: 108, name: "الكوثر", pages: [613, 614] },
                { id: 109, name: "الكافرون", pages: [614, 615] },
                { id: 110, name: "النصر", pages: [615, 616] },
                { id: 111, name: "المسد", pages: [616, 617] },
                { id: 112, name: "الإخلاص", pages: [617, 618] },
                { id: 113, name: "الفلق", pages: [618, 619] },
                { id: 114, name: "الناس", pages: [619, 620] }
            ];
            
            // Base URL for the Quran images (Madina Mushaf, 604 pages)
            // Note: This is a placeholder structure. You must host these images from a reliable source.
            // Example format: https://example.com/quran_images/page_001.png
            const QURAN_IMAGE_BASE_URL = 'https://archive.org/download/quran_images/page_';

            // --------------------------------------
            //          Initialization & State
            // --------------------------------------
            function initApp() {
                loadState();
                populateDhikrDropdown();
                setupEventListeners();
                
                // Initialize Dua categories
                renderDuaCategories();
                
                // Initialize Quran Surah list
                renderQuranSurahList();
                
                // Apply initial theme and mode
                changeTheme(currentTheme, false);
                setActiveThemeButton(currentTheme);
                applyMode(isDarkMode, false);
                updateVibrationUI(false); 
                updateDisplay();
                updateDhikrName(currentDhikr);
                dhikrSearchInput.value = currentDhikr; 
                updateDocumentTitle(); 
                
                // Check and reset completed categories if it's a new day
                checkAndResetDuaCompletion();
            }

            function getAllDhikrs() {
                const uniqueDhikrs = new Set(defaultDhikrs);
                userDhikrs.forEach(dhikr => uniqueDhikrs.add(dhikr));
                return Array.from(uniqueDhikrs);
            }

            function loadState() {
                try {
                    const savedState = localStorage.getItem('thikrAppState');
                    const savedUserDhikrs = localStorage.getItem('userDhikrs');
                    const savedDuaState = localStorage.getItem('duaReaderState');

                    if (savedUserDhikrs) {
                        userDhikrs = JSON.parse(savedUserDhikrs);
                    }

                    if (savedState) {
                        const state = JSON.parse(savedState);
                        count = state.count || 0;
                        previousCount = state.previousCount || 0;
                        
                        const allDhikrs = getAllDhikrs();
                        // Ensure the current dhikr is still in the list (or fallback to the first default)
                        currentDhikr = allDhikrs.includes(state.currentDhikr) ? state.currentDhikr : allDhikrs[0];
                        
                        currentTheme = state.theme || 'default';
                        isDarkMode = state.isDarkMode !== undefined ? state.isDarkMode : true;
                        isVibrationEnabled = state.isVibrationEnabled !== undefined ? state.isVibrationEnabled : true;
                    } else {
                        currentDhikr = defaultDhikrs[0];
                    }

                    if (savedDuaState) {
                        duaReaderState = JSON.parse(savedDuaState);
                    }
                } catch (e) {
                    console.error("Failed to load state from LocalStorage:", e);
                    currentDhikr = defaultDhikrs[0];
                    userDhikrs = [];
                    duaReaderState = { currentCategory: null, currentIndex: 0, completedToday: {}, duaCounters: {} };
                }
            }
            
            function saveState() {
                const state = {
                    count,
                    previousCount,
                    currentDhikr,
                    isDarkMode,
                    theme: currentTheme,
                    isVibrationEnabled 
                };
                localStorage.setItem('thikrAppState', JSON.stringify(state));
                localStorage.setItem('userDhikrs', JSON.stringify(userDhikrs));
                localStorage.setItem('duaReaderState', JSON.stringify(duaReaderState));
            }

            // --------------------------------------
            //          Dhikr Management
            // --------------------------------------
            
            function populateDhikrDropdown(filter = '') {
                dhikrDropdown.innerHTML = '';
                const allDhikrs = getAllDhikrs();
                
                const filteredDhikrs = allDhikrs.filter(dhikr => 
                    dhikr.toLowerCase().includes(filter.toLowerCase())
                );

                if (filteredDhikrs.length === 0 && filter !== '') {
                    const noResults = document.createElement('li');
                    noResults.textContent = "لا توجد نتائج مطابقة";
                    noResults.classList.add('dhikr-dropdown-item');
                    noResults.style.color = 'gray';
                    noResults.style.cursor = 'default';
                    dhikrDropdown.appendChild(noResults);
                    return;
                }

                filteredDhikrs.forEach(dhikr => {
                    const li = document.createElement('li');
                    li.textContent = dhikr;
                    li.classList.add('dhikr-dropdown-item');
                    li.setAttribute('data-value', dhikr);
                    
                    if (dhikr === currentDhikr) {
                        li.classList.add('selected');
                    }
                    
                    li.addEventListener('click', () => handleDhikrSelection(dhikr));
                    dhikrDropdown.appendChild(li);
                });
            }

            function handleDhikrSelection(newDhikr) {
                if (newDhikr === currentDhikr) {
                    hideDhikrDropdown();
                    return;
                }

                if (count > 0) {
                    dhikrSelectionPending = newDhikr;
                    showModal(dhikrResetModal);
                } else {
                    changeDhikr(newDhikr);
                    hideDhikrDropdown();
                }
            }

            function changeDhikr(newDhikr) {
                currentDhikr = newDhikr;
                updateDhikrName(newDhikr);
                dhikrSearchInput.value = newDhikr; 
                resetCounter(false); // Reset counter on Dhikr change
                dhikrSelectionPending = null;
                saveState();
                populateDhikrDropdown(); 
                updateDocumentTitle();
            }

            function updateDhikrName(name) {
                dhikrNameElement.textContent = name;
            }

            function toggleDhikrDropdown(show) {
                dhikrDropdown.style.display = show ? 'block' : 'none';
            }

            function hideDhikrDropdown() {
                toggleDhikrDropdown(false);
            }

            // --------------------------------------
            //            Custom Dhikr Logic
            // --------------------------------------

            function openAddDhikrModal() {
                showModal(addDhikrModal);
                newDhikrInput.value = '';
                newDhikrInput.focus();
            }

            function saveNewDhikr() {
                const newDhikr = newDhikrInput.value.trim();
                
                if (newDhikr === '') {
                    showToast("الرجاء كتابة الذكر أولاً.");
                    return;
                }

                const allDhikrs = getAllDhikrs();

                if (allDhikrs.includes(newDhikr)) {
                    showToast("هذا الذكر موجود بالفعل.");
                    hideModal(addDhikrModal);
                    changeDhikr(newDhikr); 
                    return;
                }

                userDhikrs.push(newDhikr);
                hideModal(addDhikrModal);
                changeDhikr(newDhikr);
                showToast(`تم إضافة "${newDhikr}" بنجاح.`);
            }

            // --------------------------------------
            //             Counter Logic
            // --------------------------------------
            
            function handleCounterClick() {
                previousCount = count; 
                count++;
                updateDisplay();
                createParticles();
                vibrate(50); 
                updateDocumentTitle();

                if (targetCounts.includes(count)) {
                    showToast(`ما شاء الله! لقد أكملت ${count} تسبيحة.`, 4000); 
                    vibrate(200); 
                }
                
                saveState();
            }
            
            function handleUndoClick() {
                if (count > 0) {
                    count = previousCount;
                    updateDisplay();
                    vibrate(30);
                    showToast("تم التراجع عن العد.", 1500);
                    saveState();
                    updateDocumentTitle();
                } else {
                    showToast("لا يوجد عد للتراجع عنه.");
                }
            }

            function updateDisplay() {
                counterDisplay.textContent = count;
                counterDisplay.classList.add('bounce');
                counterDisplay.addEventListener('animationend', () => {
                    counterDisplay.classList.remove('bounce');
                }, { once: true });
            }

            function resetCounter(showConfirmation = true) {
                if (showConfirmation) {
                    showModal(manualResetModal);
                } else {
                    count = 0;
                    previousCount = 0; 
                    updateDisplay();
                    saveState();
                    updateDocumentTitle();
                }
            }

            // --------------------------------------
            //               Modals
            // --------------------------------------

            function confirmDhikrChangeReset() {
                if (dhikrSelectionPending) {
                    changeDhikr(dhikrSelectionPending);
                    hideModal(dhikrResetModal);
                }
            }

            function cancelDhikrChange() {
                dhikrSearchInput.value = currentDhikr;
                dhikrSelectionPending = null;
                hideModal(dhikrResetModal);
            }

            function confirmManualReset() {
                count = 0;
                previousCount = 0;
                updateDisplay();
                vibrate(100); 
                showToast("تم تصفير العداد بنجاح.");
                saveState();
                hideModal(manualResetModal);
                updateDocumentTitle();
            }

            function cancelManualReset() {
                hideModal(manualResetModal);
            }

            function showModal(modal) {
                modal.style.display = 'flex';
                // Prevent scrolling background when modal is open
                body.style.overflow = 'hidden'; 
            }

            function hideModal(modal) {
                modal.style.display = 'none';
                body.style.overflow = 'auto'; // Restore scrolling
            }

            function showToast(message, duration = 3000) {
                toastElement.textContent = message;
                toastElement.classList.add('show');
                setTimeout(() => {
                    toastElement.classList.remove('show');
                }, duration); 
            }

            // --------------------------------------
            //            Dua Modal Logic
            // --------------------------------------
            
            function openDuasModal() {
                showModal(duasModal);
                showDuaCategoryList();
            }

            function showDuaCategoryList() {
                duaReaderView.style.display = 'none';
                duasCategoryList.style.display = 'flex';
                duasBackButton.style.display = 'none';
                closeDuasModalBtn.style.display = 'block';
                duasModalTitle.textContent = 'الأدعية المأثورة';
                renderDuaCategories();
                
                // Ensure main counter buttons are enabled when returning to Dua category list
                counterButton.disabled = false;
                dhikrSearchInput.disabled = false;
            }

            function renderDuaCategories() {
                duasCategoryList.innerHTML = '';
                duaCategories.forEach(category => {
                    const categoryItem = document.createElement('div');
                    categoryItem.classList.add('dua-category-item');
                    categoryItem.setAttribute('data-category', category.name);
                    
                    const isCompleted = isCategoryCompletedToday(category.name);
                    
                    let completionMark = '';
                    if (isCompleted) {
                        categoryItem.classList.add('completed');
                        completionMark = `<span class="completed-mark">✓</span>`;
                    }

                    categoryItem.innerHTML = `
                        ${completionMark}
                        ${category.name}
                        <div class="category-icon">${category.icon}</div>
                    `;

                    categoryItem.addEventListener('click', () => startDuaReader(category.name));
                    duasCategoryList.appendChild(categoryItem);
                });
            }

            function isCategoryCompletedToday(categoryName) {
                const today = new Date().toDateString();
                const completionStatus = duaReaderState.completedToday[categoryName];
                return completionStatus && completionStatus.date === today && completionStatus.status === true;
            }

            function markCategoryCompleted(categoryName) {
                const today = new Date().toDateString();
                duaReaderState.completedToday[categoryName] = { status: true, date: today };
                saveState();
            }

            function checkAndResetDuaCompletion() {
                const today = new Date().toDateString();
                // Check if the last completion date is today. If not, reset the completion status for the day.
                
                let resetNeeded = false;
                for (const categoryName in duaReaderState.completedToday) {
                    if (duaReaderState.completedToday[categoryName].date !== today) {
                        duaReaderState.completedToday[categoryName].status = false;
                        duaReaderState.completedToday[categoryName].date = today;
                        resetNeeded = true;
                    }
                }
                
                // Also reset dua-specific counters if the day changes, as these are usually daily counts (like subhanallah 33x)
                if (resetNeeded) {
                    duaReaderState.duaCounters = {};
                    saveState();
                    console.log("Dua completion and counters reset for the new day.");
                }
            }

            // --------------------------------------
            //            Dua Reader View
            // --------------------------------------
            let currentDuaCategory = null;

            function startDuaReader(categoryName) {
                duaReaderState.currentCategory = categoryName;
                duaReaderState.currentIndex = 0;
                currentDuaCategory = duaCategories.find(cat => cat.name === categoryName);
                
                if (!currentDuaCategory) {
                    showToast("حدث خطأ في تحميل الأدعية لهذه الفئة.");
                    return;
                }

                duasCategoryList.style.display = 'none';
                duaReaderView.style.display = 'flex';
                duasBackButton.style.display = 'block';
                closeDuasModalBtn.style.display = 'none';
                duasModalTitle.textContent = currentDuaCategory.name;

                displayCurrentDua();
            }

            function displayCurrentDua() {
                const dua = currentDuaCategory.duas[duaReaderState.currentIndex];
                
                if (!dua) {
                    // Should not happen if startDuaReader is correct, but as a safeguard
                    showToast("لا يوجد دعاء في هذه الفئة.");
                    showDuaCategoryList();
                    return;
                }

                // Update UI elements for the current Dua
                readerCategoryTitle.textContent = currentDuaCategory.name;
                duaTextElement.textContent = dua.arabic;
                duaSourceElement.textContent = `(${dua.source})`;

                // Handle Dua-specific counters (Tally mode)
                if (dua.count > 0) {
                    duaTallyArea.style.display = 'block';
                    duaCounterInfo.textContent = `تكرر ${dua.count} مرات`;
                    
                    // Initialize or load counter for this specific dua
                    const duaKey = `${duaReaderState.currentCategory}_${duaReaderState.currentIndex}`;
                    const currentTally = duaReaderState.duaCounters[duaKey] || 0;
                    
                    duaTallyCounter.textContent = currentTally;
                    
                    // Temporarily disable main counter and controls when in Dua Reader Tally mode
                    counterButton.disabled = true; 
                    dhikrSearchInput.disabled = true;
                } else {
                    duaTallyArea.style.display = 'none';
                    // Do not re-enable main counter here, as we only enable it when returning to the category list or main screen.
                }

                // Check completion status for the entire category
                const isCompleted = isCategoryCompletedToday(currentDuaCategory.name);
                completeCategoryButton.style.display = isCompleted ? 'none' : 'block';
                
                // Manage navigation buttons
                prevDuaButton.disabled = duaReaderState.currentIndex === 0;
                nextDuaButton.disabled = duaReaderState.currentIndex === currentDuaCategory.duas.length - 1;
            }

            function nextDua() {
                if (duaReaderState.currentIndex < currentDuaCategory.duas.length - 1) {
                    duaReaderState.currentIndex++;
                    displayCurrentDua();
                    saveState();
                } else if (duaReaderState.currentIndex === currentDuaCategory.duas.length - 1) {
                    // Reached the end of the category
                    markCategoryCompleted(currentDuaCategory.name);
                    showToast(`أحسنت! لقد أكملت فئة ${currentDuaCategory.name} لهذا اليوم.`);
                    showDuaCategoryList();
                }
            }

            function prevDua() {
                if (duaReaderState.currentIndex > 0) {
                    duaReaderState.currentIndex--;
                    displayCurrentDua();
                    saveState();
                }
            }

            function handleDuaTallyClick() {
                const duaKey = `${duaReaderState.currentCategory}_${duaReaderState.currentIndex}`;
                const currentDua = currentDuaCategory.duas[duaReaderState.currentIndex];
                const targetCount = currentDua.count || 0;

                if (!duaReaderState.duaCounters[duaKey]) {
                    duaReaderState.duaCounters[duaKey] = 0;
                }

                duaReaderState.duaCounters[duaKey]++;
                vibrate(50);
                createParticles();
                
                const newCount = duaReaderState.duaCounters[duaKey];
                duaTallyCounter.textContent = newCount;
                
                saveState();

                if (newCount === targetCount) {
                    showToast(`أتممت هذا الذكر (${targetCount} مرة).`, 2500);
                    vibrate(300);
                    // Move to the next dua automatically after a short delay
                    setTimeout(nextDua, 1000);
                } else if (newCount > targetCount) {
                    showToast("لقد تجاوزت العدد المطلوب. استمر إن شئت.", 1500);
                }
            }

            function handleCompleteCategory() {
                markCategoryCompleted(currentDuaCategory.name);
                showToast(`أحسنت! لقد أكملت فئة ${currentDuaCategory.name} لهذا اليوم.`);
                showDuaCategoryList();
            }

            // --------------------------------------
            //            Quran Modal Logic (New)
            // --------------------------------------

            function openQuranModal() {
                showModal(quranModal);
                showQuranSurahList();
            }

            function showQuranSurahList() {
                quranReaderView.style.display = 'none';
                quranSurahList.style.display = 'flex';
                quranBackButton.style.display = 'none';
                closeQuranModalBtn.style.display = 'block';
                quranModalTitle.textContent = 'القرآن الكريم';
                // Reset scroll position
                quranModal.querySelector('.modal-content').scrollTop = 0;
            }

            function renderQuranSurahList() {
                quranSurahList.innerHTML = '';
                quranData.forEach(surah => {
                    const surahItem = document.createElement('div');
                    surahItem.classList.add('quran-surah-item');
                    surahItem.setAttribute('data-surah-id', surah.id);
                    
                    surahItem.innerHTML = `
                        <span class="surah-number">${surah.id}</span>
                        ${surah.name}
                    `;

                    surahItem.addEventListener('click', () => startQuranReader(surah));
                    quranSurahList.appendChild(surahItem);
                });
            }

            function startQuranReader(surah) {
                quranReaderState.currentSurah = surah;
                // Start from the first page of the Surah
                quranReaderState.currentPage = surah.pages[0]; 
                
                quranSurahList.style.display = 'none';
                quranReaderView.style.display = 'flex';
                quranBackButton.style.display = 'block';
                closeQuranModalBtn.style.display = 'none';
                quranModalTitle.textContent = surah.name;

                displayQuranPage();
            }

            function displayQuranPage() {
                const currentPage = quranReaderState.currentPage;
                const surah = quranReaderState.currentSurah;

                // Format the page number (e.g., 1 -> 001) for the image URL
                const formattedPage = currentPage.toString().padStart(3, '0');
                const imageUrl = `${QURAN_IMAGE_BASE_URL}${formattedPage}.png`;

                quranPageImage.src = imageUrl;
                
                // Update page number display (e.g., Page 15 of 604)
                pageNumberDisplay.textContent = `الصفحة ${currentPage} من 604`;
                
                // Manage navigation buttons based on Surah page range
                const [startPage, endPage] = surah.pages;

                // Disable 'Next' if we are on the last page of the Surah or the Quran
                quranNextPageBtn.disabled = currentPage >= endPage;
                
                // Disable 'Prev' if we are on the first page of the Surah
                quranPrevPageBtn.disabled = currentPage <= startPage;
                
                // Scroll to the top of the modal content when the page image updates
                quranModal.querySelector('.modal-content').scrollTop = 0;
            }

            function nextQuranPage() {
                if (quranReaderState.currentSurah) {
                    const currentPage = quranReaderState.currentPage;
                    const endPage = quranReaderState.currentSurah.pages[1];
                    
                    if (currentPage < endPage) {
                        quranReaderState.currentPage++;
                        displayQuranPage();
                    }
                }
            }

            function prevQuranPage() {
                if (quranReaderState.currentSurah) {
                    const currentPage = quranReaderState.currentPage;
                    const startPage = quranReaderState.currentSurah.pages[0];
                    
                    if (currentPage > startPage) {
                        quranReaderState.currentPage--;
                        displayQuranPage();
                    }
                }
            }

            // --------------------------------------
            //            Event Listeners
            // --------------------------------------
            function setupEventListeners() {
                // Main Counter
                counterButton.addEventListener('click', handleCounterClick);
                undoButton.addEventListener('click', handleUndoClick); 
                resetButton.addEventListener('click', () => resetCounter(true));
                addDhikrButton.addEventListener('click', openAddDhikrModal);

                // Dua modal interactions
                duasButton.addEventListener('click', openDuasModal);
                closeDuasModalBtn.addEventListener('click', () => {
                    hideModal(duasModal);
                    // Ensure main counter buttons are re-enabled if they were disabled by Dua Tally
                    counterButton.disabled = false;
                    dhikrSearchInput.disabled = false;
                });
                
                // Dua Reader controls
                duasBackButton.addEventListener('click', showDuaCategoryList);
                prevDuaButton.addEventListener('click', prevDua);
                nextDuaButton.addEventListener('click', nextDua);
                completeCategoryButton.addEventListener('click', handleCompleteCategory);
                duaTallyButton.addEventListener('click', handleDuaTallyClick);

                // Quran modal interactions (New)
                quranButton.addEventListener('click', openQuranModal);
                closeQuranModalBtn.addEventListener('click', () => {
                    hideModal(quranModal);
                });
                
                // Quran Reader controls (New)
                quranBackButton.addEventListener('click', showQuranSurahList);
                quranNextPageBtn.addEventListener('click', nextQuranPage);
                quranPrevPageBtn.addEventListener('click', prevQuranPage);

                // Modal interactions
                confirmManualResetBtn.addEventListener('click', confirmManualReset);
                cancelManualResetBtn.addEventListener('click', cancelManualReset);
                confirmResetBtn.addEventListener('click', confirmDhikrChangeReset);
                cancelResetBtn.addEventListener('click', cancelDhikrChange);
                saveNewDhikrBtn.addEventListener('click', saveNewDhikr);
                cancelNewDhikrBtn.addEventListener('click', () => hideModal(addDhikrModal));
                
                newDhikrInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        saveNewDhikr();
                    }
                });

                // Dhikr search and dropdown
                dhikrSearchInput.addEventListener('click', (e) => {
                    e.stopPropagation();
                    dhikrSearchInput.removeAttribute('readonly'); 
                    populateDhikrDropdown(dhikrSearchInput.value);
                    toggleDhikrDropdown(true);
                });
                
                dhikrSearchInput.addEventListener('input', (e) => {
                    populateDhikrDropdown(e.target.value);
                    toggleDhikrDropdown(true);
                });

                // Close dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (!dhikrDropdown.contains(e.target) && e.target !== dhikrSearchInput) {
                        hideDhikrDropdown();
                        if (!dhikrSelectionPending) {
                            dhikrSearchInput.value = currentDhikr;
                        }
                        dhikrSearchInput.setAttribute('readonly', 'true'); 
                    }
                });

                // Themes and Modes
                themeToggle.addEventListener('click', toggleThemesPanel);
                modeToggle.addEventListener('click', toggleMode);
                vibrationToggle.addEventListener('click', toggleVibration); 
                
                themeButtons.forEach(button => {
                    button.addEventListener('click', handleThemeChange);
                });
            }

            // --------------------------------------
            //            Themes & Modes
            // --------------------------------------

            function toggleThemesPanel() {
                themesPanel.style.display = themesPanel.style.display === 'flex' ? 'none' : 'flex';
            }
            
            function handleThemeChange() {
                const theme = this.dataset.theme;
                currentTheme = theme;
                changeTheme(theme);
                setActiveThemeButton(theme);
                saveState();
            }
            
            // Apply CSS variables based on selected theme and mode
            function changeTheme(theme) {
                const root = document.documentElement;
                const themeColors = themes[theme];
                
                if (themeColors) {
                    if (isDarkMode) {
                        // Use Dark Mode colors from the themes object for background/text/card
                        root.style.setProperty('--theme-primary', themeColors.primary);
                        root.style.setProperty('--theme-secondary', themeColors.secondary);
                        root.style.setProperty('--theme-text', themeColors.text);
                        root.style.setProperty('--theme-card-bg', 'var(--card-bg-default)');
                        root.style.setProperty('--theme-border-color', 'var(--border-color-default)');
                        root.style.setProperty('--category-bg', 'var(--category-bg-default)');
                        root.style.setProperty('--modal-bg', 'var(--modal-bg-default)');
                    } else {
                        // Use Light Mode base colors for background/text/card
                        root.style.setProperty('--theme-primary', 'var(--light-primary-color)');
                        root.style.setProperty('--theme-secondary', 'var(--light-secondary-color)');
                        root.style.setProperty('--theme-text', 'var(--light-text-color)');
                        root.style.setProperty('--theme-card-bg', 'var(--light-card-bg)');
                        root.style.setProperty('--theme-border-color', 'var(--light-border-color)');
                        root.style.setProperty('--category-bg', 'var(--light-category-bg)');
                        root.style.setProperty('--modal-bg', 'var(--light-modal-bg)');
                    }

                    // Always apply theme-specific accent, counter, and utility colors
                    root.style.setProperty('--theme-counter', themeColors.counter);
                    root.style.setProperty('--theme-reset', themeColors.reset);
                    root.style.setProperty('--theme-add', themeColors.add);
                    root.style.setProperty('--theme-vibration', themeColors.vibration);
                    root.style.setProperty('--theme-undo', themeColors.undo);
                    root.style.setProperty('--theme-accent', themeColors.accent); 
                }
            }
            
            function setActiveThemeButton(theme) {
                themeButtons.forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.theme === theme);
                });
            }

            function toggleMode() {
                isDarkMode = !isDarkMode;
                applyMode(isDarkMode, true);
            }

            function applyMode(dark, save = true) {
                if (dark) {
                    body.classList.remove('light-mode');
                    body.classList.add('dark-mode');
                    // Sun icon path
                    modeIconPath.setAttribute('d', 'M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z'); 
                } else {
                    body.classList.remove('dark-mode');
                    body.classList.add('light-mode');
                    // Moon icon path
                    modeIconPath.setAttribute('d', 'M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z'); 
                }
                
                changeTheme(currentTheme); // Recalculate colors based on the new mode

                if (save) {
                    saveState();
                }
            }

            // --------------------------------------
            //            Vibration Control
            // --------------------------------------

            function toggleVibration() {
                isVibrationEnabled = !isVibrationEnabled;
                updateVibrationUI(true);
                saveState();
                if (isVibrationEnabled) {
                    vibrate(50); 
                    showToast("تم تفعيل الاهتزاز.");
                } else {
                    showToast("تم كتم الاهتزاز.");
                }
            }

            function updateVibrationUI() {
                if (isVibrationEnabled) {
                    vibrationToggle.classList.remove('muted');
                    vibrationToggle.classList.add('enabled');
                    // Enabled icon path
                    vibrationIconPath.setAttribute('d', 'M15.536 8.464a5 5 0 010 7.072m2.828-9.899a9 9 0 010 12.728M12 6a6 6 0 00-6 6v3.586l-2-2L3.414 15l4.586 4.586A2 2 0 009 20h6a2 2 0 002-2v-6c0-3.313-2.687-6-6-6z');
                } else {
                    vibrationToggle.classList.remove('enabled');
                    vibrationToggle.classList.add('muted');
                    // Muted icon path (simplified to show only the phone outline)
                    vibrationIconPath.setAttribute('d', 'M12 6a6 6 0 00-6 6v3.586l-2-2L3.414 15l4.586 4.586A2 2 0 009 20h6a2 2 0 002-2v-6c0-3.313-2.687-6-6-6zM15.536 8.464a5 5 0 010 7.072');
                }
            }

            // --------------------------------------
            //            Animations & Haptics
            // --------------------------------------
            
            function createParticles() {
                const themeColors = themes[currentTheme];
                const particleColor = themeColors ? themeColors.counter : '#f59e0b';
                
                const particleCount = 8;
                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.classList.add('particle');
                    
                    particle.style.setProperty('--particle-color', particleColor);
                    
                    let x, y;

                    // Determine position based on which counter is active
                    if (duaReaderView.style.display === 'flex' && duaTallyArea.style.display === 'block') {
                        const tallyButtonRect = duaTallyButton.getBoundingClientRect();
                        x = tallyButtonRect.left + tallyButtonRect.width / 2;
                        y = tallyButtonRect.top + tallyButtonRect.height / 2;
                    } else {
                        const mainButtonRect = counterButton.getBoundingClientRect();
                        x = mainButtonRect.left + mainButtonRect.width / 2;
                        y = mainButtonRect.top + mainButtonRect.height / 2;
                    }
                    
                    const size = Math.random() * 7 + 3; 
                    const duration = Math.random() * 1.2 + 0.6; 
                    const angle = Math.random() * Math.PI * 2; 
                    const distance = Math.random() * 70 + 30; 
                    
                    particle.style.width = `${size}px`;
                    particle.style.height = `${size}px`;
                    particle.style.left = `${x}px`;
                    particle.style.top = `${y}px`;
                    particle.style.opacity = '1';
                    
                    animationContainer.appendChild(particle);
                    
                    requestAnimationFrame(() => {
                        particle.style.transform = `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px)`;
                        particle.style.opacity = '0';
                    });
                    
                    setTimeout(() => {
                        particle.remove();
                    }, duration * 1000 + 50);
                }
            }

            function vibrate(ms) {
                if (isVibrationEnabled && navigator.vibrate) {
                    navigator.vibrate(ms);
                }
            }
            
            // --------------------------------------
            //            Utility Features
            // --------------------------------------

            function updateDocumentTitle() {
                document.title = `آجر - ${currentDhikr} (${count})`;
            }

            // --------------------------------------
            //                 Start
            // --------------------------------------
            initApp();
        });
    </script>
</body>
</html>
